# âš™ï¸ Autoloadé…ç½®è¯´æ˜

## ğŸ“‹ éœ€è¦é…ç½®çš„Autoload

æŒ‰ç…§ä»¥ä¸‹é¡ºåºåœ¨ `Project Settings -> Autoload` ä¸­æ·»åŠ ï¼š

### 1. LogManagerï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… Path: `res://scripts/managers/LogManager.gd`
- âœ… Node Name: `LogManager`
- âœ… ä¼˜å…ˆçº§ï¼šæœ€é«˜ï¼ˆç¬¬ä¸€ä¸ªåŠ è½½ï¼‰

### 2. GameServices
- ğŸ“ Path: `res://godot_project/autoload/GameServices.gd`
- ğŸ·ï¸ Node Name: `GameServices`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬äºŒï¼ˆä¾èµ–LogManagerï¼‰

### 3. GameEvents
- ğŸ“ Path: `res://godot_project/autoload/GameEvents.gd`
- ğŸ·ï¸ Node Name: `GameEvents`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬ä¸‰

### 4. GameGroups
- ğŸ“ Path: `res://godot_project/autoload/GameGroups.gd`
- ğŸ·ï¸ Node Name: `GameGroups`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬å››

### 5. BuildingTypes
- ğŸ“ Path: `res://godot_project/autoload/BuildingTypes.gd`
- ğŸ·ï¸ Node Name: `BuildingTypes`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬äº”
- ğŸ“ ç”¨é€”ï¼šå»ºç­‘ç±»å‹å¸¸é‡å®šä¹‰ï¼Œé¿å…é­”æ³•æ•°å­—

### 6. BuildingStatus
- ğŸ“ Path: `res://autoload/BuildingStatus.gd`
- ğŸ·ï¸ Node Name: `BuildingStatus`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬å…­
- ğŸ“ ç”¨é€”ï¼šå»ºç­‘çŠ¶æ€å¸¸é‡å®šä¹‰ï¼Œæ¶ˆé™¤é­”æ³•æ•°å­—ï¼ˆ0,1,2ï¼‰
- âœ… å·²é…ç½®åˆ° project.godot

### 7. TileTypes âš ï¸ **éœ€è¦é…ç½®**
- ğŸ“ Path: `res://autoload/TileTypes.gd`
- ğŸ·ï¸ Node Name: `TileTypes`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬ä¸ƒ
- ğŸ“ ç”¨é€”ï¼šç“¦ç‰‡ç±»å‹å¸¸é‡ï¼Œåœ°å›¾ç³»ç»Ÿæ”¯æŒ

### 8. CharacterTypes âš ï¸ **éœ€è¦é…ç½®**
- ğŸ“ Path: `res://autoload/CharacterTypes.gd`
- ğŸ·ï¸ Node Name: `CharacterTypes`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬å…«
- ğŸ“ ç”¨é€”ï¼šè§’è‰²ç±»å‹å¸¸é‡ï¼Œé¿å…å­—ç¬¦ä¸²æ‹¼å†™é”™è¯¯

### 9. CombatTypes âš ï¸ **éœ€è¦é…ç½®**
- ğŸ“ Path: `res://autoload/CombatTypes.gd`
- ğŸ·ï¸ Node Name: `CombatTypes`
- ğŸ“Œ ä¼˜å…ˆçº§ï¼šç¬¬ä¹
- ğŸ“ ç”¨é€”ï¼šæˆ˜æ–—ç³»ç»Ÿå¸¸é‡ï¼ˆä¼¤å®³ç±»å‹ã€æ•ˆæœã€è®¡ç®—ï¼‰

---

## ğŸ”§ é…ç½®æ­¥éª¤

1. æ‰“å¼€ Godot Editor
2. ç‚¹å‡»èœå• `Project -> Project Settings`
3. é€‰æ‹© `Autoload` æ ‡ç­¾
4. ç‚¹å‡» `Add` æŒ‰é’®
5. æµè§ˆå¹¶é€‰æ‹©å¯¹åº”çš„ `.gd` æ–‡ä»¶
6. è®¾ç½® `Node Name`ï¼ˆå¿…é¡»ä¸ä¸Šé¢ä¸€è‡´ï¼‰
7. ç‚¹å‡» `Add` å®Œæˆ

é‡å¤ä»¥ä¸Šæ­¥éª¤æ·»åŠ æ‰€æœ‰Autoloadã€‚

---

## âœ… éªŒè¯é…ç½®

é…ç½®å®Œæˆåï¼Œåœ¨ `Project Settings -> Autoload` ä¸­åº”è¯¥çœ‹åˆ°ï¼š

```
[å·²å¯ç”¨] LogManager
[å·²å¯ç”¨] GameServices
[å·²å¯ç”¨] GameEvents
[å·²å¯ç”¨] GameGroups
[å·²å¯ç”¨] GridPathFinder
[å·²å¯ç”¨] BuildingTypes
[å·²å¯ç”¨] BuildingStatus
[å¾…æ·»åŠ ] TileTypes  âš ï¸
[å¾…æ·»åŠ ] CharacterTypes  âš ï¸
[å¾…æ·»åŠ ] CombatTypes  âš ï¸
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

é…ç½®å®Œæˆåï¼Œå¯ä»¥åœ¨ä»»ä½•è„šæœ¬ä¸­ç›´æ¥ä½¿ç”¨ï¼š

```gdscript
# è®¿é—®ç®¡ç†å™¨
var physics = GameServices.physics_system
var resources = GameServices.resource_manager

# å‘é€äº‹ä»¶
GameEvents.resource_changed.emit("gold", 100, 1000)

# ç›‘å¬äº‹ä»¶
func _ready():
	GameEvents.character_spawned.connect(_on_character_spawned)

# ä½¿ç”¨Groups
GameGroups.add_to_group(self, GameGroups.WORKERS)
var all_workers = GameGroups.get_all_workers()

# ä½¿ç”¨BuildingTypes
if building.building_type == BuildingTypes.DUNGEON_HEART:
    print("è¿™æ˜¯åœ°ç‰¢ä¹‹å¿ƒ")
var name = BuildingTypes.get_building_name(building.building_type)

# ä½¿ç”¨BuildingStatus
if building.status == BuildingStatus.COMPLETED:
    print("å»ºç­‘å·²å®Œæˆ")
var status_name = BuildingStatus.get_status_name(building.status)

# ä½¿ç”¨TileTypes
if TileTypes.is_walkable(tile_type):
    allow_movement()

# ä½¿ç”¨CharacterTypes
var name = CharacterTypes.get_character_name(CharacterTypes.GOBLIN_WORKER)

# ä½¿ç”¨CombatTypes
var damage = CombatTypes.calculate_actual_damage(100, 20, CombatTypes.PHYSICAL_DAMAGE)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åŠ è½½é¡ºåºå¾ˆé‡è¦**ï¼šLogManagerå¿…é¡»ç¬¬ä¸€ä¸ªï¼ŒGameServicesç¬¬äºŒä¸ª
2. **Node Nameå¿…é¡»ç²¾ç¡®åŒ¹é…**ï¼šä»£ç ä¸­ä½¿ç”¨çš„æ˜¯è¿™äº›åç§°
3. **ä¸è¦é‡å¤æ·»åŠ **ï¼šæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåAutoload
4. **æµ‹è¯•éªŒè¯**ï¼šæ·»åŠ åè¿è¡Œæ¸¸æˆï¼Œæ£€æŸ¥æ§åˆ¶å°è¾“å‡º

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ‰¾ä¸åˆ°GameServices
**A**: æ£€æŸ¥Autoloadæ˜¯å¦æ­£ç¡®é…ç½®ï¼ŒNode Nameæ˜¯å¦ä¸º "GameServices"

### Q: æŠ¥é”™"Invalid call..."
**A**: ç¡®ä¿LogManagerå·²é…ç½®ä¸”åœ¨GameServicesä¹‹å‰

### Q: ä¿¡å·ä¸è§¦å‘
**A**: æ£€æŸ¥æ˜¯å¦æ­£ç¡®è¿æ¥ï¼Œä½¿ç”¨ `GameEvents.signal_name.connect(callback)`

---

## ğŸ“š æ›´å¤šä¿¡æ¯

æŸ¥çœ‹å®Œæ•´é‡æ„æ–¹æ¡ˆï¼š`docs/REFACTORING_PLAN.md`

