# 🌍 生态系统设计文档

## 概述

生态系统模块是MazeMaster3D游戏的核心组件之一，负责管理游戏世界中的各种生态区域、资源生成和生物生成。该模块采用模块化设计，与统一阵营系统深度集成，为游戏世界增添了丰富的生态关系和真实的生物行为。

## 系统架构

### 核心设计理念

1. **模块化设计**：各组件独立且可扩展
2. **阵营集成**：与统一阵营系统深度集成
3. **性能优化**：支持大规模生态区域管理
4. **真实生态**：模拟真实的生态系统关系

### 系统层次结构

```
生态系统模块
├── 生态区域管理 (EcosystemRegion)
│   ├── 区域生成
│   ├── 区域特性
│   └── 区域查询
├── 资源系统 (ResourceTypes)
│   ├── 资源类型定义
│   ├── 资源配置
│   └── 资源生成
├── 生物系统 (CreatureTypes)
│   ├── 生物类型定义
│   ├── 生物配置
│   └── 生物生成
└── 生态系统管理器 (EcosystemManager)
    ├── 区域协调
    ├── 资源管理
    ├── 生物管理
    └── 阵营集成
```

## 目录结构

```
scripts/ecosystem/
├── EcosystemManager.gd          # 生态系统管理器（主控制器）
├── ForestEcosystem.gd           # 森林生态系统模块
├── GrasslandEcosystem.gd        # 草地生态系统模块
├── LakeEcosystem.gd             # 湖泊生态系统模块
├── CaveEcosystem.gd             # 洞穴生态系统模块
├── WastelandEcosystem.gd        # 荒地生态系统模块
├── DeadLandEcosystem.gd         # 死地生态系统模块
├── PrimitiveEcosystem.gd        # 原始生态系统模块

autoload/ (生态系统相关)
├── ResourceTypes.gd             # 资源类型定义 (已移至autoload)
├── CreatureTypes.gd             # 生物类型定义 (已移至autoload)
└── EcosystemRegion.gd           # 生态区域管理 (已移至autoload)

scripts/characters/beasts/ (生物实现)
├── Deer.gd                      # 鹿
├── ForestWolf.gd                # 森林狼
├── ShadowTiger.gd               # 影刃虎
├── ClawBear.gd                  # 巨爪熊
├── Rabbit.gd                    # 野兔
├── GrasslandWolf.gd             # 草原狼
├── RhinoBeast.gd                # 犀角兽
├── WaterGrassFish.gd            # 水草鱼
├── Plankton.gd                  # 浮游生物
├── Fish.gd                      # 鱼
├── WaterSnake.gd                # 水蛇
├── FishMan.gd                   # 鱼人
├── WaterBird.gd                 # 水鸟
├── LakeMonster.gd               # 湖怪
├── GiantRat.gd                  # 巨鼠
├── PoisonScorpion.gd            # 毒刺蝎
├── StoneBeetle.gd               # 石甲虫
├── ShadowSpider.gd              # 暗影蜘蛛
├── CaveBat.gd                   # 洞穴蝙蝠
├── GiantLizard.gd               # 巨蜥
├── RadioactiveScorpion.gd       # 辐射蝎
├── SandstormWolf.gd             # 沙暴狼
├── MutantRat.gd                 # 变异老鼠
├── CorruptedWorm.gd             # 腐化蠕虫
├── ShadowWolf.gd                # 暗影魔狼
├── CorruptedBoar.gd             # 腐化野猪
├── MagicVulture.gd              # 魔化秃鹫
├── HellHound.gd                 # 地狱犬
├── ShadowPanther.gd             # 暗影魔豹
├── AbyssDragon.gd               # 深渊魔龙
├── HornShieldBeast.gd           # 角盾龙（食草）
├── SpineBackBeast.gd            # 棘背龙（食草）
├── ScaleArmorBeast.gd           # 鳞甲龙（杂食）
├── ClawHunterBeast.gd           # 利爪龙（杂食）
├── RageBeast.gd                 # 暴怒龙（掠食者）
├── ShadowBeast.gd               # 暗影龙（掠食者）
├── DragonBloodBeast.gd          # 龙血兽（顶级掠食者）
├── AncientDragonOverlord.gd     # 古龙霸主（终极统治者）
└── beast_states/                # 野兽状态机
```

## 核心组件详解

### 1. EcosystemManager.gd - 生态系统管理器

**功能**：生态系统的主控制器，负责协调所有生态系统的生成和更新。

**核心职责**：
- 生态区域生成和管理
- 资源生成和重生机制
- 生物生成和重生机制
- 食物链系统更新
- 阵营系统集成
- 性能优化和内存管理
- 集成7个独立生态系统模块

**关键功能**：
- 生成生态区域：根据地图大小和区域数量生成生态区域
- 区域查询：获取指定区域内的资源和生物
- 资源管理：收获资源并管理资源重生
- 食物链更新：自动更新生态系统食物链
- 模块集成：使用独立的生态系统模块生成资源和生物
- 系统清理：清空生态系统数据

**配置参数**：
- 生态系统概率：森林25%、草地25%、湖泊10%、洞穴20%、荒地5%、死地5%、原始10%
- 资源生成：密度10%、集群大小3
- 生物生成：密度5%、集群大小2

### 2. ResourceTypes.gd - 资源类型定义

**功能**：定义所有资源类型和配置，支持26种不同的资源类型。

**资源类型分类**：
- **基础资源**：木材、食物、水、石头
- **植物资源**：浆果、草药、蘑菇、水产植物
- **矿物资源**：铁矿、金矿、宝石、稀有矿物
- **魔法资源**：魔法水晶、精华、灵魂石、魔化核心、诅咒宝石、死灵花
- **原始资源**：原始植物、史前矿物、化石、琥珀、原始水晶、龙血石、古龙鳞片

**资源属性**：
- 资源类型、位置坐标、数量、重生时间、活跃状态、最后收获时间

**生态资源配置**：
- **森林资源**：木材、浆果、草药
- **草地资源**：食物、草药
- **湖泊资源**：水、鱼类、水产植物、浮游生物
- **洞穴资源**：矿物、宝石、蘑菇
- **荒地资源**：稀有矿物
- **死地资源**：魔法水晶、精华、灵魂石、魔化核心、诅咒宝石、死灵花
- **原始资源**：原始植物、史前矿物、化石、琥珀、原始水晶、龙血石、古龙鳞片

### 3. CreatureTypes.gd - 生物类型定义

**功能**：定义所有生物类型和配置，支持42种不同的生物类型。

**生物类型分类**：
- **森林生物**：鹿、森林狼、影刃虎、巨爪熊
- **草地生物**：野兔、草原狼、犀角兽
- **湖泊生物**：水草鱼、浮游生物、鱼、水蛇、鱼人、水鸟、湖怪
- **洞穴生物**：巨鼠、毒刺蝎、石甲虫、暗影蜘蛛、洞穴蝙蝠
- **荒地生物**：巨蜥、辐射蝎、沙暴狼、变异老鼠、腐化蠕虫
- **死地生物**：暗影魔狼、腐化野猪、魔化秃鹫、地狱犬、暗影魔豹、深渊魔龙
- **原始生物**：角盾龙、棘背龙、鳞甲龙、利爪龙、暴怒龙、暗影龙、龙血兽、古龙霸主

**生物属性**：
- 生物类型、位置坐标、等级、敌对状态、重生时间、活跃状态、最后生成时间

**阵营映射**：
- **野兽阵营（中立）**：鹿、森林狼、影刃虎、巨爪熊、野兔、草原狼、犀角兽、水草鱼、浮游生物、鱼、水蛇、鱼人、水鸟、湖怪、巨鼠、毒刺蝎、石甲虫、暗影蜘蛛、洞穴蝙蝠、巨蜥、辐射蝎、沙暴狼、变异老鼠、腐化蠕虫、角盾龙、棘背龙、鳞甲龙、利爪龙、暴怒龙、暗影龙、龙血兽、古龙霸主、暗影魔狼、腐化野猪、魔化秃鹫、地狱犬、暗影魔豹、深渊魔龙
- **怪物阵营（敌对）**：无（所有生物都属于野兽阵营）

### 4. 独立生态系统模块

**ForestEcosystem.gd - 森林生态系统**
- **功能**：管理森林生态系统的资源和生物生成
- **特点**：温和环境，资源丰富
- **生物**：鹿、森林狼、影刃虎、巨爪熊
- **资源**：木材、浆果、草药
- **食物链**：树木/浆果/草药 → 鹿 → 森林狼 → 影刃虎/巨爪熊

**GrasslandEcosystem.gd - 草地生态系统**
- **功能**：管理草地生态系统的资源和生物生成
- **特点**：开阔平原，适合建造
- **生物**：野兔、草原狼、犀角兽
- **资源**：食物、草药、耕地
- **食物链**：草料/耕地作物 → 野兔 → 草原狼 → 犀角兽

**LakeEcosystem.gd - 湖泊生态系统**
- **功能**：管理湖泊生态系统的资源和生物生成
- **特点**：水域环境，复杂的水生生态
- **生物**：水草鱼、浮游生物、鱼、水蛇、鱼人、水鸟、湖怪
- **资源**：水、鱼类、水生植物、浮游生物
- **食物链**：水生植物/浮游生物 → 水草鱼/鱼 → 水蛇/鱼人 → 水鸟 → 湖怪

**CaveEcosystem.gd - 洞穴生态系统**
- **功能**：管理洞穴生态系统的资源和生物生成
- **特点**：地下环境，矿物丰富
- **生物**：巨鼠、毒刺蝎、石甲虫、暗影蜘蛛、洞穴蝙蝠
- **资源**：矿物、宝石、蘑菇
- **食物链**：蘑菇 → 巨鼠 → 毒刺蝎/石甲虫 → 暗影蜘蛛/洞穴蝙蝠

**WastelandEcosystem.gd - 荒地生态系统**
- **功能**：管理荒地生态系统的资源和生物生成
- **特点**：恶劣环境，稀有矿物
- **生物**：巨蜥、辐射蝎、沙暴狼、变异老鼠、腐化蠕虫
- **资源**：稀有矿物、石头、腐化植物
- **食物链**：腐化植物 → 变异老鼠/腐化蠕虫 → 辐射蝎/沙暴狼 → 巨蜥

**DeadLandEcosystem.gd - 死地生态系统**
- **功能**：管理死地生态系统的资源和生物生成
- **特点**：最危险环境，魔化野兽，魔法资源丰富
- **生物**：暗影魔狼、腐化野猪、魔化秃鹫、地狱犬、暗影魔豹、深渊魔龙
- **资源**：魔法水晶、精华、灵魂石、魔化核心、诅咒宝石、死灵花
- **食物链**：魔法资源 → 暗影魔狼 → 腐化野猪 → 魔化秃鹫/地狱犬 → 暗影魔豹 → 深渊魔龙

**PrimitiveEcosystem.gd - 原始生态系统**
- **功能**：管理原始生态系统的资源和生物生成
- **特点**：史前环境，以各种恐龙为核心，资源丰富但危险
- **生物**：角盾龙、棘背龙、鳞甲龙、利爪龙、暴怒龙、暗影龙、龙血兽、古龙霸主
- **资源**：原始植物、史前矿物、化石、琥珀、原始水晶、龙血石、古龙鳞片
- **食物链**：原始植物 → 角盾龙/棘背龙 → 鳞甲龙/利爪龙 → 暴怒龙/暗影龙 → 龙血兽 → 古龙霸主

### 5. EcosystemRegion.gd - 生态区域管理

**功能**：管理单个生态区域的详细信息，包括区域特性生成。

**生态区域属性**：
- 位置坐标、区域大小、生态类型、资源生成点、生物生成点、特殊特性、活跃状态、最后更新时间

**生态类型**：
- 森林、草地、湖泊、洞穴、荒地、死地、原始

**区域特性生成**：
- **森林特性**：古树、浆果丛、草药生长点、虎穴、熊洞
- **草地特性**：野花田、水井、农田
- **湖泊特性**：小岛、瀑布、深水区、浅滩、水草丛、浮游生物聚集区、水鸟栖息地、湖怪巢穴
- **洞穴特性**：钟乳石、水晶洞、深洞、地下湖、虫巢、蝙蝠洞
- **荒地特性**：废弃建筑、辐射区域、沙漠绿洲、矿物富集区、辐射坑、鼠洞、腐化土壤
- **死地特性**：黑暗祭坛、魔法阵、诅咒区域、魔化洞穴、深渊裂缝、魔龙巢穴、诅咒祭坛
- **原始特性**：恐龙巢穴、史前遗迹、化石坑、原始森林、火山口、龙血池、古龙圣地、龙骨墓地

## 生态类型详解

### 1. FOREST - 森林 🌲
- **主要瓦片类型**: EMPTY (空地) - 50-60%
- **特殊瓦片类型**: 
  - FOREST_CLEARING (森林空地) 🌲 - 在森林内部的小片空地
  - DENSE_FOREST (茂密森林) 🌳 - 42% (森林的70%)
  - FOREST_EDGE (森林边缘) 🌿 - 围绕森林区域的边缘
  - ANCIENT_FOREST (古树区域) 🌲 - 18% (森林的30%)
- **地块分布**: 使用地理分布算法，符合森林生态规律
- **特点**: 温和环境，资源丰富，适合生存
- **资源**: 木材、浆果、草药
- **生物**: 鹿（食草）、森林狼（中型掠食者）、影刃虎（顶级掠食者）、巨爪熊（顶级掠食者）
- **食物链**: 树木/浆果/草药 → 鹿 → 森林狼 → 影刃虎/巨爪熊
- **特殊特性**: 古树、浆果丛、草药生长点、虎穴、熊洞
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 影刃虎和巨爪熊控制森林狼数量，森林狼控制鹿的数量
- **地理分布**: 
  - 森林区域占比60%（茂密森林70% + 古树区域30%）
  - 古树区域位于森林中心，形成连接的区域
  - 森林边缘围绕森林区域分布
  - 森林空地在森林内部生成2-5个小片空地

### 2. GRASSLAND - 草地 🌱
- **主要瓦片类型**: EMPTY (空地) - 50-60%
- **特殊瓦片类型**: 
  - GRASSLAND_PLAINS (草原平原) 🌱 - 36% (草地的60%)
  - GRASSLAND_HILLS (草原丘陵) ⛰️ - 9.6% (其他草地的40%)
  - GRASSLAND_WETLANDS (草原湿地) 🌊 - 7.2% (其他草地的30%)
  - GRASSLAND_FIELDS (草原农田) 🌾 - 7.2% (其他草地的30%)
- **地块分布**: 使用地理分布算法，符合草原生态规律
- **特点**: 开阔平原，适合建造和耕作
- **资源**: 食物、草药、耕地作物
- **生物**: 野兔（食草）、草原狼（中型掠食者）、犀角兽（顶级掠食者）
- **食物链**: 草料/耕地作物 → 野兔 → 草原狼 → 犀角兽
- **特殊特性**: 野花田、水井、农田
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 犀角兽驱赶草原狼，草原狼控制野兔数量
- **地理分布**: 
  - 草地区域占比60%（草原平原60% + 其他草地类型40%）
  - 草原平原为主要区域，占比36%
  - 其他草地类型：丘陵40%、湿地30%、农田30%

### 3. LAKE - 湖泊 🏞️
- **主要瓦片类型**: EMPTY (空地) - 20-30%
- **特殊瓦片类型**: 
  - LAKE_SHALLOW (浅水区) 🏞️ - 48% (水域的60%)
  - LAKE_DEEP (深水区) 🌊 - 32% (水域的40%)
  - LAKE_SHORE (湖岸) 🏖️ - 围绕水域边缘
  - LAKE_ISLAND (湖心岛) 🏝️ - 在深水区中心
- **地块分布**: 使用地理分布算法，符合现实地理规律
- **特点**: 水域环境，复杂的水生生态系统
- **资源**: 水、鱼类、水生植物、浮游生物
- **生物**: 水草鱼（小型食草）、浮游生物（微型食草）、鱼（中型食草）、水蛇（中等掠食者）、鱼人（高级掠食者）、水鸟（飞行掠食者）、湖怪（顶级掠食者）
- **食物链**: 水生植物/浮游生物 → 水草鱼/鱼 → 水蛇/鱼人 → 水鸟 → 湖怪
- **特殊特性**: 小岛、瀑布、深水区、浅滩、水草丛、浮游生物聚集区、水鸟栖息地、湖怪巢穴
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 复杂的食物链维持湖泊生态平衡，湖怪统治深水区域
- **地理分布**: 
  - 水域占比80%（浅水区60% + 深水区40%）
  - 深水区位于湖泊中心，形成连接的区域
  - 湖岸围绕水域边缘分布
  - 湖心岛在深水区中心生成1-3个

### 4. CAVE - 洞穴 🕳️
- **主要瓦片类型**: EMPTY (空地) - 40%
- **特殊瓦片类型**: 
  - CAVE_DEEP (深洞) ⛏️ - 12% (洞穴的20%)
  - CAVE_CRYSTAL (水晶洞) 💎 - 9% (洞穴的15%)
  - CAVE_UNDERGROUND_LAKE (地下湖) 🌊 - 39% (洞穴的65%) - 生成在中心区域
- **地块分布**: 使用地理分布算法，符合洞穴生态规律
- **特点**: 地下环境，矿物丰富，需要挖掘
- **资源**: 矿物、宝石、蘑菇
- **生物**: 巨鼠（食草）、毒刺蝎（小型掠食者）、石甲虫（中型掠食者）、暗影蜘蛛（大型掠食者）、洞穴蝙蝠（飞行掠食者）
- **食物链**: 蘑菇 → 巨鼠 → 毒刺蝎/石甲虫 → 暗影蜘蛛/洞穴蝙蝠
- **特殊特性**: 钟乳石、水晶洞、深洞、地下湖、虫巢、蝙蝠洞
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 暗影蜘蛛和洞穴蝙蝠控制虫类数量，巨鼠群体行为维持生态平衡
- **地理分布**: 
  - 洞穴区域占比60%（深洞20% + 水晶洞15% + 地下湖65%）
  - 深洞位于洞穴深处
  - 水晶洞富含矿物资源
  - 地下湖位于洞穴中心区域，提供水源

### 5. WASTELAND - 荒地 🏜️
- **主要瓦片类型**: EMPTY (空地) - 40%
- **特殊瓦片类型**: 
  - WASTELAND_DESERT (荒地沙漠) 🏜️ - 24% (荒地的40%)
  - WASTELAND_ROCKS (荒地岩石) 🗻 - 18% (荒地的30%)
  - WASTELAND_RUINS (荒地废墟) 🏚️ - 12% (荒地的20%)
  - WASTELAND_TOXIC (荒地毒区) ☢️ - 6% (荒地的10%) - 生成在边缘区域
- **地块分布**: 使用地理分布算法，符合荒地生态规律
- **特点**: 恶劣环境，资源稀少但稀有矿物丰富
- **资源**: 稀有矿物、石头、腐化植物
- **生物**: 巨蜥（顶级掠食者）、辐射蝎（变异生物）、沙暴狼（沙漠生物）、变异老鼠（初级消费者）、腐化蠕虫（初级消费者）
- **食物链**: 腐化植物 → 变异老鼠/腐化蠕虫 → 辐射蝎/沙暴狼 → 巨蜥
- **特殊特性**: 废弃建筑、辐射区域、沙漠绿洲、矿物富集区、辐射坑、鼠洞、腐化土壤
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 巨蜥控制其他生物数量，适应恶劣环境
- **地理分布**: 
  - 荒地区域占比60%（沙漠40% + 岩石30% + 废墟20% + 毒区10%）
  - 沙漠为主要区域，占比24%
  - 毒区生成在空洞的边缘区域，形成危险的边界地带

### 6. DEAD_LAND - 死地 💀
- **主要瓦片类型**: EMPTY (空地) - 50-60%
- **特殊瓦片类型**: 
  - DEAD_LAND_SWAMP (死亡沼泽) 🐊
  - DEAD_LAND_GRAVEYARD (墓地) ⚰️
- **地块分布**: 特殊地块以2-4个聚类区域形式分布，每个区域内部地块类型统一
- **特点**: 最危险环境，魔化野兽，魔法资源丰富
- **资源**: 魔法水晶、精华、灵魂石、魔化核心、诅咒宝石、死灵花
- **生物**: 暗影魔狼（初级魔物）、腐化野猪（次级魔物）、魔化秃鹫（高级魔物）、地狱犬（高级魔物）、暗影魔豹（顶级魔物）、深渊魔龙（终极统治者）
- **食物链**: 魔法资源 → 暗影魔狼 → 腐化野猪 → 魔化秃鹫/地狱犬 → 暗影魔豹 → 深渊魔龙
- **特殊特性**: 黑暗祭坛、魔法阵、诅咒区域、魔化洞穴、深渊裂缝、魔龙巢穴、诅咒祭坛
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 魔化等级制度，深渊魔龙统治魔化野兽群，暗影魔豹控制中低级魔物

### 7. PRIMITIVE - 原始生态系统 🦕
- **主要瓦片类型**: EMPTY (空地) - 50-60%
- **特殊瓦片类型**: 
  - PRIMITIVE_JUNGLE (原始丛林) 🦕
  - PRIMITIVE_VOLCANO (原始火山) 🌋
  - PRIMITIVE_SWAMP (原始沼泽) 🐊
- **地块分布**: 特殊地块以2-4个聚类区域形式分布，每个区域内部地块类型统一
- **特点**: 史前环境，以各种恐龙为核心，资源丰富但危险
- **资源**: 原始植物、史前矿物、化石、琥珀、原始水晶、龙血石、古龙鳞片
- **生物**: 角盾龙（食草）、棘背龙（食草）、鳞甲龙（杂食）、利爪龙（杂食）、暴怒龙（掠食者）、暗影龙（掠食者）、龙血兽（顶级掠食者）、古龙霸主（终极统治者）
- **食物链**: 原始植物 → 角盾龙/棘背龙 → 鳞甲龙/利爪龙 → 暴怒龙/暗影龙 → 龙血兽 → 古龙霸主
- **特殊特性**: 恐龙巢穴、史前遗迹、化石坑、原始森林、火山口、龙血池、古龙圣地、龙骨墓地
- **阵营关系**: 野兽阵营（中立）
- **生态平衡**: 恐龙族群制度，古龙霸主统治领地

## 食物链系统

### 概述
MazeMaster3D实现了完整的生态系统食物链，模拟真实的生态关系和生物行为。

### 森林生态系统食物链
```
生产者: 树木、浆果、草药
├── 初级消费者: 鹿（食草动物）
│   ├── 觅食行为: 寻找浆果和草药
│   └── 逃避行为: 受到威胁时逃跑
├── 次级消费者: 森林狼（中型掠食者）
│   ├── 捕食行为: 猎杀鹿
│   ├── 领地行为: 巡逻领地
│   └── 逃避行为: 躲避顶级掠食者
├── 顶级掠食者: 影刃虎（顶级掠食者）
│   ├── 捕食行为: 猎杀森林狼和鹿
│   ├── 潜伏行为: 在阴影中伏击猎物
│   ├── 领地行为: 守卫大片森林领地
│   └── 生态平衡: 控制森林狼数量
└── 顶级掠食者: 巨爪熊（顶级掠食者）
    ├── 杂食行为: 既吃植物也捕食其他动物
    ├── 力量攻击: 使用巨爪进行强力攻击
    ├── 领地行为: 守卫熊洞周围区域
    └── 生态平衡: 与影刃虎竞争领地
```

### 草地生态系统食物链
```
生产者: 草料、耕地作物、草药
├── 初级消费者: 野兔（小型食草动物）
│   ├── 觅食行为: 快速繁殖，大量消耗草料
│   └── 逃避行为: 受到威胁时快速逃跑
├── 次级消费者: 草原狼（中型掠食者）
│   ├── 捕食行为: 主要捕食野兔
│   └── 竞争行为: 与犀角兽竞争
└── 顶级掠食者: 犀角兽（大型掠食者）
    ├── 领地行为: 守卫大片领地
    └── 驱赶行为: 驱赶草原狼
```

### 湖泊生态系统食物链
```
生产者: 水生植物、藻类、浮游植物
├── 初级消费者: 浮游生物（微型食草动物）
│   ├── 觅食行为: 以浮游植物和藻类为食
│   ├── 群体行为: 形成浮游生物群
│   └── 基础作用: 为整个食物链提供基础营养
├── 初级消费者: 水草鱼（小型食草动物）
│   ├── 觅食行为: 以水生植物为食
│   ├── 群体行为: 形成小型鱼群
│   └── 逃避行为: 受到威胁时快速游动
├── 初级消费者: 鱼（中型食草动物）
│   ├── 觅食行为: 以水生植物和浮游生物为食
│   ├── 群体行为: 形成大型鱼群
│   └── 游泳能力: 具有优秀的游泳能力
├── 次级消费者: 水蛇（中等掠食者）
│   ├── 捕食行为: 捕食水草鱼和小型鱼类
│   ├── 潜伏攻击: 在水中潜伏等待猎物
│   ├── 游泳能力: 具有优秀的游泳和潜水能力
│   └── 领地行为: 守卫浅水区域
├── 次级消费者: 鱼人（高级掠食者）
│   ├── 捕食行为: 猎杀鱼类和水草鱼
│   ├── 领地行为: 守卫水域领地
│   ├── 工具使用: 使用简单的捕鱼工具
│   └── 群体行为: 形成小型的鱼人群落
├── 高级消费者: 水鸟（飞行掠食者）
│   ├── 捕食行为: 捕食鱼类、水草鱼和水蛇
│   ├── 飞行优势: 在空中盘旋寻找猎物
│   ├── 潜水能力: 从空中俯冲潜水捕食
│   ├── 群体行为: 群体狩猎和栖息
│   └── 领地行为: 守卫湖泊周边区域
└── 顶级掠食者: 湖怪（大型掠食者）
    ├── 捕食行为: 捕食所有其他水生生物
    ├── 统治行为: 统治湖泊深水区域
    ├── 巨大体型: 拥有巨大的体型和力量
    ├── 潜伏能力: 在深水中潜伏等待猎物
    ├── 领地意识: 控制整个湖泊的核心区域
    └── 生态平衡: 维持湖泊生态系统的顶级平衡
```

### 洞穴生态系统食物链
```
生产者: 蘑菇、腐殖质
├── 初级消费者: 巨鼠（食草动物）
│   ├── 觅食行为: 以蘑菇为食
│   └── 群体行为: 群体觅食
├── 次级消费者: 毒刺蝎（小型掠食者）
│   ├── 捕食行为: 捕食巨鼠和腐殖质
│   ├── 毒性攻击: 使用毒刺攻击猎物
│   └── 潜伏行为: 隐藏在洞穴缝隙中
├── 中级消费者: 石甲虫（中型掠食者）
│   ├── 捕食行为: 捕食毒刺蝎和巨鼠
│   ├── 甲壳防御: 坚硬的外壳提供保护
│   └── 挖掘能力: 挖掘洞穴和寻找食物
├── 高级消费者: 暗影蜘蛛（大型掠食者）
│   ├── 捕食行为: 捕食石甲虫和毒刺蝎
│   ├── 蛛网陷阱: 设置蛛网捕捉猎物
│   ├── 潜伏行为: 在洞穴深处潜伏
│   └── 生态平衡: 控制洞穴昆虫数量
└── 顶级消费者: 洞穴蝙蝠（飞行掠食者）
    ├── 捕食行为: 捕食所有小型生物
    ├── 飞行优势: 在空中追击猎物
    ├── 群体行为: 群体狩猎
    └── 生态平衡: 维持洞穴生态平衡
```

### 荒地生态系统食物链
```
生产者: 腐化植物、耐旱植物
├── 初级消费者: 变异老鼠（变异生物）
│   ├── 觅食行为: 以腐化植物为食
│   ├── 变异特性: 具有辐射抗性，体型增大
│   ├── 群体行为: 形成老鼠群体
│   └── 适应能力: 适应恶劣的荒地环境
├── 初级消费者: 腐化蠕虫（变异生物）
│   ├── 觅食行为: 以腐化植物和土壤为食
│   ├── 变异特性: 具有腐蚀性体液
│   ├── 挖掘能力: 在地下挖掘隧道
│   └── 适应能力: 适应辐射和腐化环境
├── 次级消费者: 辐射蝎（变异生物）
│   ├── 捕食行为: 捕食变异老鼠和腐化蠕虫
│   ├── 辐射攻击: 使用辐射毒素攻击
│   ├── 适应能力: 完全适应辐射环境
│   └── 变异特性: 体型巨大，甲壳坚硬
├── 中级消费者: 沙暴狼（沙漠生物）
│   ├── 捕食行为: 捕食辐射蝎、变异老鼠和腐化蠕虫
│   ├── 沙暴能力: 制造沙暴掩护攻击
│   ├── 群体行为: 群体狩猎
│   └── 适应能力: 适应沙漠和荒地环境
└── 顶级掠食者: 巨蜥（大型掠食者）
    ├── 捕食行为: 捕食所有其他生物
    ├── 领地行为: 守卫稀有矿物区域
    ├── 适应能力: 完全适应恶劣环境
    ├── 力量攻击: 使用巨大的力量和尾巴攻击
    └── 生态平衡: 控制整个荒地食物链
```

### 死地生态系统食物链
```
生产者: 魔法资源、腐化植物、死灵花
├── 初级消费者: 暗影魔狼（初级魔物）
│   ├── 觅食行为: 以魔法水晶和腐化植物为食
│   ├── 魔化特性: 被魔法力量魔化，具有暗影能力
│   └── 群体行为: 形成魔狼群，集体狩猎
├── 次级消费者: 腐化野猪（次级魔物）
│   ├── 捕食行为: 捕食暗影魔狼和腐化植物
│   ├── 腐化能力: 身体被魔法腐化，具有毒性
│   ├── 冲撞攻击: 使用腐化獠牙进行冲撞攻击
│   └── 防御能力: 腐化皮肤提供强大防御
├── 高级消费者: 魔化秃鹫（高级魔物）
│   ├── 捕食行为: 捕食腐化野猪和暗影魔狼
│   ├── 飞行优势: 在空中盘旋寻找猎物
│   ├── 魔法攻击: 使用魔法羽毛攻击
│   └── 腐化传播: 通过接触传播腐化效果
├── 高级消费者: 地狱犬（高级魔物）
│   ├── 捕食行为: 捕食腐化野猪和暗影魔狼
│   ├── 火焰攻击: 喷吐地狱火焰
│   ├── 快速移动: 具有极高的移动速度
│   └── 撕咬攻击: 使用地狱犬牙攻击
├── 顶级消费者: 暗影魔豹（顶级魔物）
│   ├── 捕食行为: 捕食魔化秃鹫和地狱犬
│   ├── 统治行为: 统治中低级魔物
│   ├── 暗影潜行: 在阴影中潜行攻击
│   ├── 魔法攻击: 使用暗影魔法攻击
│   └── 领地行为: 守卫死地核心区域
└── 终极统治者: 深渊魔龙（魔龙统治者）
    ├── 统治行为: 控制整个魔化野兽群
    ├── 龙威压制: 释放强大的龙威压制其他生物
    ├── 深渊魔法: 使用强大的深渊魔法
    ├── 飞行能力: 拥有强大的飞行能力
    └── 生态平衡: 维持死地生态系统的秩序
```

### 原始生态系统食物链 🦕
```
生产者: 原始植物、史前蕨类、原始树木
├── 初级消费者: 角盾龙（食草恐龙）
│   ├── 觅食行为: 以原始植物为食
│   ├── 群体行为: 形成防御性族群
│   ├── 角盾防御: 使用头部巨角和盾状鳞片防御
│   └── 逃避行为: 受到威胁时快速逃跑
├── 初级消费者: 棘背龙（食草恐龙）
│   ├── 觅食行为: 以原始植物为食
│   ├── 群体行为: 形成警戒性族群
│   ├── 棘背威慑: 背部的巨型棘刺威慑敌人
│   └── 警戒行为: 时刻保持警戒状态
├── 次级消费者: 鳞甲龙（杂食恐龙）
│   ├── 杂食行为: 既吃植物也捕食角盾龙和棘背龙
│   ├── 适应能力: 适应多种食物来源
│   ├── 鳞甲防御: 坚硬的鳞片提供强大防御
│   └── 竞争行为: 与其他鳞甲龙竞争领地
├── 次级消费者: 利爪龙（杂食恐龙）
│   ├── 杂食行为: 既吃植物也捕食角盾龙和棘背龙
│   ├── 利爪攻击: 使用锋利的利爪攻击
│   ├── 快速移动: 具有极高的移动速度
│   └── 狩猎行为: 主动狩猎小型恐龙
├── 高级消费者: 暴怒龙（掠食恐龙）
│   ├── 捕食行为: 主要捕食鳞甲龙和利爪龙
│   ├── 领地行为: 守卫大片狩猎领地
│   ├── 暴怒状态: 进入暴怒状态时攻击力翻倍
│   └── 威慑行为: 通过咆哮威慑其他生物
├── 高级消费者: 暗影龙（掠食恐龙）
│   ├── 捕食行为: 主要捕食鳞甲龙和利爪龙
│   ├── 暗影潜行: 在阴影中潜行攻击
│   ├── 暗影攻击: 使用暗影力量攻击
│   └── 恐惧光环: 释放恐惧效果
├── 顶级掠食者: 龙血兽（超级掠食者）
│   ├── 捕食行为: 捕食暴怒龙和暗影龙
│   ├── 龙血力量: 拥有龙血的力量
│   ├── 龙息攻击: 使用龙息攻击
│   └── 统治行为: 统治大片原始领地
└── 终极统治者: 古龙霸主（终极统治者）
    ├── 统治行为: 统治整个原始生态系统
    ├── 古龙威压: 释放古龙的强大威压
    ├── 龙鳞防御: 拥有古龙鳞片的无敌防御
    ├── 龙魂攻击: 使用龙魂力量攻击
    ├── 领地意识: 控制整个原始世界的领地
    └── 生态平衡: 维持恐龙族群的生态平衡
```

### 食物链特性

#### 基础生态特性
- **动态平衡**: 掠食者控制猎物数量，猎物数量影响掠食者生存
- **领地行为**: 大型生物有领地意识，驱赶其他生物
- **群体行为**: 小型生物有群体聚集行为
- **环境适应**: 生物适应各自的环境特点

#### 森林生态系统特性
- **潜伏伏击**: 影刃虎等掠食者具有潜伏伏击能力
- **杂食适应**: 巨爪熊等生物具有杂食适应性
- **竞争关系**: 影刃虎和巨爪熊竞争领地

#### 草地生态系统特性
- **快速繁殖**: 野兔快速繁殖，大量消耗草料
- **驱赶行为**: 犀角兽驱赶草原狼
- **竞争行为**: 草原狼与犀角兽竞争

#### 湖泊生态系统特性
- **浮游生物群**: 浮游生物形成密集的浮游生物群，为食物链提供基础
- **分层觅食**: 水草鱼在浅水区觅食，鱼在深水区觅食
- **群体行为**: 鱼类和水草鱼都形成鱼群，提高生存率
- **潜伏攻击**: 水蛇在水中潜伏等待猎物，具有优秀的游泳能力
- **工具使用**: 鱼人使用简单的捕鱼工具，体现智慧
- **飞行优势**: 水鸟在空中盘旋寻找猎物，具有飞行优势
- **潜水能力**: 水鸟从空中俯冲潜水捕食，水蛇具有优秀的潜水能力
- **巨大体型**: 湖怪拥有巨大的体型和力量，统治深水区域
- **分层生态**: 不同生物占据湖泊的不同深度，形成分层生态结构

#### 洞穴生态系统特性
- **毒性攻击**: 毒刺蝎等昆虫具有毒性攻击能力
- **甲壳防御**: 石甲虫具有坚硬的外壳
- **蛛网陷阱**: 暗影蜘蛛设置蛛网捕捉猎物
- **飞行优势**: 洞穴蝙蝠等飞行生物具有空中优势
- **挖掘能力**: 石甲虫具有挖掘洞穴的能力

#### 荒地生态系统特性
- **辐射适应**: 荒地生物具有辐射抗性和辐射攻击能力
- **沙暴能力**: 沙暴狼具有制造沙暴掩护的能力
- **变异特性**: 变异老鼠具有辐射抗性，体型增大
- **群体行为**: 变异老鼠形成老鼠群体
- **腐蚀体液**: 腐化蠕虫具有腐蚀性体液
- **挖掘能力**: 腐化蠕虫在地下挖掘隧道

#### 死地生态系统特性
- **魔化等级制度**: 死地魔化野兽有严格的等级制度
- **魔化特性**: 暗影魔狼被魔法力量魔化，具有暗影能力
- **群体狩猎**: 暗影魔狼形成魔狼群，集体狩猎
- **腐化能力**: 腐化野猪身体被魔法腐化，具有毒性
- **冲撞攻击**: 腐化野猪使用腐化獠牙进行冲撞攻击
- **飞行优势**: 魔化秃鹫在空中盘旋寻找猎物
- **魔法攻击**: 魔化秃鹫使用魔法羽毛攻击
- **火焰攻击**: 地狱犬喷吐地狱火焰
- **快速移动**: 地狱犬具有极高的移动速度
- **暗影潜行**: 暗影魔豹在阴影中潜行攻击
- **魔法攻击**: 暗影魔豹使用暗影魔法攻击
- **龙威压制**: 深渊魔龙释放强大的龙威压制其他生物
- **深渊魔法**: 深渊魔龙使用强大的深渊魔法
- **飞行能力**: 深渊魔龙拥有强大的飞行能力

#### 原始生态系统特性
- **族群制度**: 原始生态系统中恐龙有复杂的族群结构
- **角盾防御**: 角盾龙使用头部巨角和盾状鳞片防御
- **棘背威慑**: 棘背龙背部的巨型棘刺威慑敌人
- **鳞甲防御**: 鳞甲龙坚硬的鳞片提供强大防御
- **利爪攻击**: 利爪龙使用锋利的利爪攻击
- **快速移动**: 利爪龙具有极高的移动速度
- **暴怒状态**: 暴怒龙进入暴怒状态时攻击力翻倍
- **威慑行为**: 暴怒龙通过咆哮威慑其他生物
- **暗影潜行**: 暗影龙在阴影中潜行攻击
- **暗影攻击**: 暗影龙使用暗影力量攻击
- **恐惧光环**: 暗影龙释放恐惧效果
- **龙血力量**: 龙血兽拥有龙血的力量
- **龙息攻击**: 龙血兽使用龙息攻击
- **古龙威压**: 古龙霸主释放古龙的强大威压
- **龙鳞防御**: 古龙霸主拥有古龙鳞片的无敌防御
- **龙魂攻击**: 古龙霸主使用龙魂力量攻击
- **统治行为**: 古龙霸主统治整个原始生态系统

### 食物链系统总结

#### 生态系统复杂度对比
1. **原始生态系统** - 最复杂（6层食物链）
   - 生产者 → 初级消费者 → 次级消费者 → 高级消费者 → 顶级掠食者 → 终极统治者

2. **死地生态系统** - 复杂（6层食物链）
   - 生产者 → 初级消费者 → 次级消费者 → 高级消费者 → 顶级消费者 → 终极统治者

3. **洞穴生态系统** - 复杂（5层食物链）
   - 生产者 → 初级消费者 → 次级消费者 → 中级消费者 → 高级消费者 → 顶级消费者

4. **荒地生态系统** - 中等（4层食物链）
   - 生产者 → 初级消费者 → 次级消费者/中级消费者 → 顶级掠食者

5. **森林生态系统** - 中等（4层食物链）
   - 生产者 → 初级消费者 → 次级消费者 → 顶级掠食者

6. **草地生态系统** - 简单（3层食物链）
   - 生产者 → 初级消费者 → 次级消费者 → 顶级掠食者

7. **湖泊生态系统** - 复杂（5层食物链）
   - 生产者 → 初级消费者 → 次级消费者 → 高级消费者 → 顶级掠食者

#### 生物类型分布
- **初级消费者**: 鹿、野兔、浮游生物、水草鱼、鱼、巨鼠、变异老鼠、腐化蠕虫、暗影魔狼、角盾龙、棘背龙
- **次级消费者**: 森林狼、草原狼、水蛇、鱼人、毒刺蝎、辐射蝎、腐化野猪、鳞甲龙、利爪龙
- **中级消费者**: 石甲虫、沙暴狼
- **高级消费者**: 暗影蜘蛛、水鸟、魔化秃鹫、地狱犬、暴怒龙、暗影魔豹
- **顶级消费者**: 洞穴蝙蝠
- **顶级掠食者**: 影刃虎、巨爪熊、犀角兽、巨蜥、湖怪、龙血兽
- **终极统治者**: 深渊魔龙、古龙霸主

#### 特殊能力分布
- **飞行能力**: 洞穴蝙蝠、水鸟、魔化秃鹫、深渊魔龙
- **潜水能力**: 水蛇、水鸟
- **游泳能力**: 水草鱼、鱼、水蛇、鱼人、湖怪
- **挖掘能力**: 石甲虫、腐化蠕虫
- **毒性攻击**: 毒刺蝎、辐射蝎
- **魔法攻击**: 魔化秃鹫、暗影魔豹、深渊魔龙
- **群体行为**: 野兔、巨鼠、变异老鼠、洞穴蝙蝠、暗影魔狼、浮游生物、水草鱼、鱼、角盾龙、棘背龙
- **角盾防御**: 角盾龙
- **棘背威慑**: 棘背龙
- **鳞甲防御**: 鳞甲龙
- **利爪攻击**: 利爪龙
- **快速移动**: 利爪龙
- **暴怒状态**: 暴怒龙
- **威慑行为**: 暴怒龙
- **暗影潜行**: 暗影龙
- **暗影攻击**: 暗影龙
- **恐惧光环**: 暗影龙
- **龙血力量**: 龙血兽
- **龙息攻击**: 龙血兽
- **古龙威压**: 古龙霸主
- **龙鳞防御**: 古龙霸主
- **龙魂攻击**: 古龙霸主
- **龙威压制**: 深渊魔龙
- **飞行能力**: 深渊魔龙

## 阵营系统集成

### 野兽阵营特性

**中立性**：
- 对所有其他阵营都是中立的
- 不会主动攻击英雄或怪物
- 受到攻击时会逃跑

**行为模式**：
- 觅食行为：寻找食物和资源
- 逃跑机制：受到威胁时逃跑
- 游荡行为：在区域内自由移动

**阵营判断逻辑**：
- 野兽对所有阵营都是中立的
- 野兽不会主动攻击其他阵营
- 野兽受到攻击时会逃跑


## 性能优化

### 1. 分块系统
- 支持大规模地图的生态区域管理
- 动态加载和卸载生态区域
- 减少内存占用

### 2. 资源管理
- 资源重生机制
- 资源池管理
- 内存回收

### 3. 生物管理
- 生物重生机制
- 生物行为优化
- 碰撞检测优化

## 使用方法

### 基本使用

**创建生态系统管理器**：
- 自动初始化7个生态系统模块
- 添加到场景树中

**生成生态区域**：
- 使用模块化系统生成生态区域
- 根据地图大小和区域数量生成

**区域查询功能**：
- 获取指定区域内的资源
- 获取指定区域内的生物
- 支持半径范围查询

**自动更新机制**：
- 食物链系统自动在_process中更新
- 无需手动调用更新方法

### 配置生态系统

**自定义配置**：
- 设置各生态系统的生成概率
- 调整资源生成密度和集群大小
- 调整生物生成密度和集群大小

**配置应用**：
- 将配置应用到生态系统管理器
- 影响后续的生态区域生成

### 创建野兽单位

**创建生物**：
- 加载对应的生物脚本
- 设置正确的阵营属性
- 添加到场景中

**生物属性设置**：
- 设置阵营关系
- 配置攻击性等行为属性

### 检查阵营关系

**阵营关系检查**：
- 检查是否为敌人关系
- 检查是否为友军关系
- 检查是否为中立关系

## 扩展指南

### 添加新的生态类型

1. 在 `EcosystemRegion.gd` 中添加新的 `EcosystemType`
2. 创建新的生态系统模块文件（如 `NewEcosystem.gd`）
3. 在 `ResourceTypes.gd` 中添加对应的资源配置
4. 在 `CreatureTypes.gd` 中添加对应的生物配置
5. 在 `EcosystemManager.gd` 中添加新的生态系统模块引用
6. 更新 `_generate_region_resources_with_modules()` 和 `_generate_region_creatures_with_modules()` 方法
7. 更新 `update_ecosystem_food_chains()` 方法
8. 更新阵营映射关系

### 添加新的资源类型

1. 在 `ResourceTypes.gd` 中添加新的 `ResourceType`
2. 更新各生态系统的资源配置
3. 添加资源名称和图标函数
4. 更新资源生成逻辑

### 添加新的生物类型

1. 在 `CreatureTypes.gd` 中添加新的 `CreatureType`
2. 更新各生态系统的生物配置
3. 添加生物名称和图标函数
4. 设置正确的阵营映射
5. 创建具体的生物类文件（如 `NewBeast.gd`）
6. 在 `EcosystemManager.gd` 的 `_get_beast_scene()` 方法中添加新的生物映射
7. 更新对应生态系统模块中的食物链逻辑

### 添加新的阵营类型

1. 在 `Enums.gd` 中添加新的 `Faction`
2. 更新阵营判断逻辑
3. 更新碰撞层设置
4. 更新生物阵营映射

## 测试系统

### 生态系统测试

**测试内容**：
- 资源类型和配置测试
- 生物类型和配置测试
- 生态区域生成测试
- 资源生成测试
- 生物生成测试
- 区域查询功能测试
- 食物链系统测试
- 生态系统模块集成测试

### 食物链系统测试

**测试内容**：
- 捕食关系测试
- 觅食行为测试
- 领地行为测试
- 群体行为测试
- 生态平衡测试
- 跨生态系统交互测试

### 阵营系统测试

**测试内容**：
- 阵营创建测试
- 敌对关系测试
- 友军关系测试
- 中立关系测试
- 碰撞层测试
- 野兽阵营中立性测试
- 魔化野兽等级制度测试

## 地图生成器集成

### 生态系统地块生成逻辑

MazeMaster3D的地图生成器现在采用新的生态系统地块生成策略，确保更自然和合理的地块分布：

#### 生成策略

**主要原则**：
- **以EMPTY为主**: 大部分生态系统空洞中50-60%的地块为 `EMPTY` 类型
- **湖泊特殊处理**: 湖泊生态系统中20-30%的地块为 `EMPTY` 类型，70-80%为特殊地块
- **特殊地块聚类**: 40-50%的地块为特殊生态系统地块，形成2-4个连接的区域
- **区域统一性**: 每个聚类区域内部使用相同的地块类型
- **自然形状**: 使用聚类算法确保区域形状自然，不是规则的矩形

#### 聚类算法

**`_generate_ecosystem_clusters()` 主函数**：
- 根据生态系统类型计算特殊地块数量
- 湖泊生态系统：70-80%特殊地块，20-30%空地
- 其他生态系统：40-50%特殊地块，50-60%空地
- 调用改进的间距控制聚类算法
- 为每个聚类分配特殊地块类型，确保不同类型不相邻

**`_generate_spaced_cluster_regions()` 间距控制聚类区域生成**：
- 每个地块类型生成2-3个聚类群，确保分布均匀
- 增加聚类群数量，减少每个聚类的地块数量
- 限制最大聚类数量，避免过多小聚类
- 计算更小的目标聚类大小

**`_grow_spaced_cluster()` 间距控制聚类生长算法**：
- 从随机起始位置开始
- 使用广度优先搜索（BFS）算法
- 向8个方向扩展（包括对角线）
- 检查与已使用位置的最小距离（2格）
- 确保不同类型地块保持间距

**`_assign_tile_types_with_spacing()` 地块类型分配算法**：
- 记录每种地块类型的使用次数
- 选择使用次数最少的地块类型
- 确保不同类型地块均匀分布
- 避免相同类型地块过度集中

#### 生态系统地块类型映射

**森林生态系统**：
- `FOREST_CLEARING` (森林空地) 🌲
- `DENSE_FOREST` (茂密森林) 🌳
- `FOREST_EDGE` (森林边缘) 🌿
- `ANCIENT_FOREST` (古树区域) 🌲

**草地生态系统**：
- `GRASSLAND_PLAINS` (草原平原) 🌱
- `GRASSLAND_HILLS` (草原丘陵) ⛰️
- `GRASSLAND_WETLANDS` (草原湿地) 🌊
- `GRASSLAND_FIELDS` (草原农田) 🌾

**湖泊生态系统**：
- `LAKE_SHALLOW` (浅水区) 🏞️
- `LAKE_DEEP` (深水区) 🌊
- `LAKE_SHORE` (湖岸) 🏖️
- `LAKE_ISLAND` (湖心岛) 🏝️

**洞穴生态系统**：
- `CAVE_DEEP` (深洞) ⛏️
- `CAVE_CRYSTAL` (水晶洞) 💎
- `CAVE_UNDERGROUND_LAKE` (地下湖) 🌊

**荒地生态系统**：
- `WASTELAND_DESERT` (荒地沙漠) 🏜️
- `WASTELAND_ROCKS` (荒地岩石) 🗻
- `WASTELAND_RUINS` (荒地废墟) 🏚️
- `WASTELAND_TOXIC` (荒地毒区) ☢️

**死地生态系统**：
- `DEAD_LAND_CORRUPTED` (死地腐化) 💀
- `DEAD_LAND_GRAVEYARD` (死地墓地) ⚰️
- `DEAD_LAND_NECROPOLIS` (死地死城) 🏛️
- `DEAD_LAND_VOID` (死地虚空) 🕳️

**原始生态系统**：
- `PRIMITIVE_JUNGLE` (原始丛林) 🦕
- `PRIMITIVE_VOLCANO` (原始火山) 🌋
- `PRIMITIVE_SWAMP` (原始沼泽) 🐊

#### 生成效果示例

**森林空洞生成效果**：
```
🌿🌿🌳🌳🌳🌳🌿🌿
🌿🌳🌳🌳🌳🌳🌳🌿
🌳🌳🌲🌲🌲🌲🌳🌳
🌳🌳🌲🌲🌲🌲🌳🌳
🌳🌳🌲🌲🌲🌲🌳🌳
🌳🌳🌲🌲🌲🌲🌳🌳
🌿🌳🌳🌳🌳🌳🌳🌿
🌿🌿🌳🌳🌳🌳🌿🌿
```

**草地空洞生成效果**：
```
🌱🌱🌱🌱🌱🌱🌱🌱
🌱🌱🌱🌱🌱🌱🌱🌱
🌱🌱⛰️⛰️🌊🌾🌱🌱
🌱🌱⛰️⛰️🌊🌾🌱🌱
🌱🌱🌱🌱🌱🌱🌱🌱
🌱🌱🌱🌱🌱🌱🌱🌱
🌱🌱🌱🌱🌱🌱🌱🌱
🌱🌱🌱🌱🌱🌱🌱🌱
```

**湖泊空洞生成效果**：
```
🏖️🏖️🏞️🏞️🏞️🏞️🏖️🏖️
🏖️🏞️🏞️🏞️🏞️🏞️🏞️🏖️
🏞️🏞️🌊🌊🏝️🌊🌊🏞️🏞️
🏞️🏞️🌊🌊🌊🌊🌊🏞️🏞️
🏞️🏞️🌊🌊🌊🌊🌊🏞️🏞️
🏞️🏞️🌊🌊🌊🌊🌊🏞️🏞️
🏖️🏞️🏞️🏞️🏞️🏞️🏞️🏖️
🏖️🏖️🏞️🏞️🏞️🏞️🏖️🏖️
```

**洞穴空洞生成效果**：
```
⛏️⛏️💎🌊🌊🌊💎⛏️⛏️
⛏️🌊🌊🌊🌊🌊🌊🌊⛏️
💎🌊🌊🌊🌊🌊🌊🌊💎
🌊🌊🌊🌊🌊🌊🌊🌊🌊
🌊🌊🌊🌊🌊🌊🌊🌊🌊
🌊🌊🌊🌊🌊🌊🌊🌊🌊
💎🌊🌊🌊🌊🌊🌊🌊💎
⛏️🌊🌊🌊🌊🌊🌊🌊⛏️
⛏️⛏️💎🌊🌊🌊💎⛏️⛏️
```

**荒地空洞生成效果**：
```
☢️☢️🏜️🏜️🏜️🏜️☢️☢️
☢️🏜️🏜️🗻🗻🏚️🏜️☢️
🏜️🏜️🗻🗻🏚️🏚️🏜️🏜️
🏜️🗻🗻🏚️🏚️🏚️🗻🏜️
🏜️🗻🏚️🏚️🏚️🏚️🗻🏜️
🏜️🏜️🗻🏚️🏚️🗻🏜️🏜️
☢️🏜️🏜️🗻🗻🏜️🏜️☢️
☢️☢️🏜️🏜️🏜️🏜️☢️☢️
```

#### 技术特点

- ✅ **地理分布算法**: 湖泊、森林、草地、洞穴和荒地生态系统使用特殊的地理分布算法，符合现实地理规律
- ✅ **比例控制**: 大部分生态系统40-50%特殊地块，50-60%空地；湖泊生态系统80%水域，20%空地；森林生态系统60%森林，40%空地；草地生态系统60%草地，40%空地；洞穴生态系统60%洞穴，40%空地；荒地生态系统60%荒地，40%空地
- ✅ **水域分布**: 浅水区60% + 深水区40% = 80%水域，深水区位于中心形成连接区域
- ✅ **湖岸生成**: 围绕水域边缘自动生成湖岸地块
- ✅ **湖心岛生成**: 在深水区中心生成1-3个湖心岛
- ✅ **森林分布**: 茂密森林70% + 古树区域30% = 60%森林，古树区域位于中心形成连接区域
- ✅ **森林边缘生成**: 围绕森林区域边缘自动生成森林边缘地块
- ✅ **森林空地生成**: 在森林内部生成2-5个小片空地
- ✅ **草地分布**: 草原平原60% + 其他草地类型40% = 60%草地，草原平原为主要区域
- ✅ **草地类型分配**: 丘陵40%、湿地30%、农田30%
- ✅ **荒地分布**: 沙漠40% + 岩石30% + 废墟20% + 毒区10% = 60%荒地，毒区生成在边缘区域
- ✅ **洞穴分布**: 地下湖位于中心区域，深洞和水晶洞分布在周围
- ✅ **多聚类群分布**: 每个地块类型生成2-3个聚类群，增加分布密度
- ✅ **小聚类设计**: 减少每个聚类的地块数量，增加聚类群数量
- ✅ **类型间距**: 不同类型地块之间保持2格最小距离
- ✅ **均匀分布**: 使用次数最少的地块类型优先分配
- ✅ **自然形状**: 8方向扩展形成自然区域
- ✅ **无重叠**: 聚类之间不会重叠

## 注意事项

### 性能考虑

1. 确保在 `MapGenerator.gd` 中正确初始化 `EcosystemManager`
2. 资源重生时间以秒为单位
3. 生物重生时间以秒为单位
4. 区域大小建议在 8x8 到 16x16 之间
5. 资源密度和生物密度建议在 0.05 到 0.2 之间

### 阵营系统注意事项

1. 野兽阵营对所有其他阵营都是中立的，不会主动攻击或被攻击
2. 死地生物（暗影魔狼、腐化野猪、深渊魔龙等）属于野兽阵营，对所有阵营中立
3. 碰撞层设置确保了不同阵营单位可以正确检测到彼此
4. 野兽受到攻击时会逃跑，体现了野生动物的特性

### 内存管理

1. 定期清理不活跃的资源点
2. 使用对象池管理生物实例
3. 及时释放不再需要的生态区域

## 未来计划

### 短期目标
- [ ] 添加季节变化系统
- [ ] 实现生态系统之间的相互作用
- [ ] 添加天气系统
- [ ] 优化性能表现

### 中期目标
- [ ] 实现生态系统的动态演化
- [ ] 添加更多特殊特性和事件
- [ ] 实现生物迁徙系统
- [ ] 添加生态平衡机制

### 长期目标
- [x] 实现复杂的食物链系统（已完成）
- [ ] 添加气候变化影响
- [ ] 实现生态系统的自我调节
- [ ] 添加玩家对生态系统的影响
- [ ] 实现跨生态系统的生物迁徙
- [ ] 添加生态系统的动态演化机制

## 总结

生态系统模块为MazeMaster3D游戏提供了丰富而真实的生态内容，通过7个独立的生态系统模块和完整的食物链系统，实现了复杂而有趣的生态关系。

### 🌟 核心特性

1. **模块化架构**: 7个独立的生态系统模块，每个都有独特的生态特征
2. **完整食物链**: 从生产者到顶级掠食者的完整生态链
3. **动态平衡**: 生物间的相互作用维持生态平衡
4. **阵营集成**: 所有生物都属于野兽阵营（中立），创造统一的中立生态关系
5. **真实生态**: 模拟真实的生物行为和生态关系
6. **智能间距控制地块生成**: 使用改进的聚类算法生成自然的地块分布，不同类型地块保持2格间距，每个地块类型生成2-3个聚类群，减少单个聚类大小，增加分布密度
7. **生态系统地块**: 27种特殊地块类型，每个生态系统3-6种，形成视觉和功能上的多样性

### 🎮 游戏体验

- **探索价值**: 每个生态系统都有独特的生物群落和资源
- **策略深度**: 生态平衡影响资源获取和生物管理
- **动态世界**: 食物链系统创造不断变化的游戏世界
- **阵营关系**: 野兽中立特性增加游戏世界的真实性
- **视觉多样性**: 27种特殊地块类型提供丰富的视觉体验
- **自然分布**: 间距控制聚类算法确保地块分布自然合理，避免人工感
- **间距美感**: 不同类型地块保持2格间距，创造更美观的地图布局
- **分布密度**: 更多小聚类群提供更丰富的探索体验

### 🔧 技术优势

- **高性能**: 模块化设计优化性能
- **易扩展**: 独立的生态系统模块便于添加新内容
- **可维护**: 清晰的架构和文档
- **可配置**: 丰富的配置选项支持不同游戏需求
- **智能算法**: 间距控制BFS聚类算法确保地块连接和自然分布
- **类型安全**: 27种预定义地块类型，避免魔法数字
- **间距控制**: 2格最小距离确保不同类型地块不冲突
- **均匀分布**: 使用计数算法确保地块类型均匀分布

这个完善的生态系统为MazeMaster3D提供了坚实的基础，不仅实现了文档中规划的所有功能，还增加了完整的食物链系统和智能间距控制地块生成算法。通过27种特殊地块类型和改进的聚类算法，游戏世界更加生动、自然和有趣。新的地图生成器确保每个生态系统都有合理的空地分布、连接的特殊区域和美观的间距布局，为玩家提供更好的探索体验。
