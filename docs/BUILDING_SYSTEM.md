# 🏗️ War for the Overworld - 完整建筑图鉴

## 📚 图鉴概述

本图鉴收录了 War for the Overworld 世界中所有已知的建筑类型，从基础的金库到神秘的暗影神殿，从实用的工坊到强大的防御设施。每种建筑都有其独特的功能和战略价值。通过深入了解这些建筑的特性，你将能够更好地规划你的地下帝国！

### 🎮 游戏内访问
在游戏中按 **数字键1-3** 可以选择建造模式，支持以下功能：
- 🔨 **建造选项**: 查看可建造的建筑列表
- 💰 **成本显示**: 显示建造所需的资源
- ⏱️ **时间预估**: 显示预计建造时间
- 👷 **工程师状态**: 显示可用工程师数量

### 🔧 地精工程师系统
游戏中的建筑建造由**地精工程师**负责，具备以下特性：
- **智能工作流程**: 自动获取金币、前往工地、执行建造任务
- **状态指示器**: 实时显示工程师的工作状态（横向空心长方形指示器）
- **金币管理**: 每次携带60金币，建造耗尽才补充，无任务时归还
- **工作优先级**: 工作优先于游荡，持续检查新任务
- **建造速度**: 每秒投入4金币，高效完成建造任务
- **工程师管理**: 建筑自动管理分配的工程师，拒绝多余工程师
- **空闲转游荡**: 工程师空闲1秒后自动转为游荡状态，提高工作效率
- **移动系统集成**: 使用统一的MovementSystem进行所有移动操作，确保移动逻辑一致
- **自动分配器**: 智能任务分配系统，自动为工程师分配最适合的工作任务
- **智能状态切换**: 工程师等待超时自动切换到游荡状态，保持工作效率

#### 🎯 工程师工作优先级系统
工程师采用智能优先级系统，确保高效完成各种建筑任务：

**状态优先级（从高到低）**:
1. **资源管理优先**: `RETURNING_TO_BASE` - 携带金币时优先返回主基地存储
2. **寻找工作目标**: `IDLE` - 空闲时寻找需要工作的建筑
3. **资源获取**: `FETCHING_RESOURCES` - 金币不足时前往主基地获取
4. **前往工作地点**: `MOVING_TO_SITE` - 前往目标建筑位置
5. **执行工作**: `CONSTRUCTING/REPAIRING/UPGRADING/RELOADING` - 实际工作状态
6. **游荡状态**: `WANDERING` - 空闲超过1秒且无目标时游荡

**建筑选择优先级（建筑管理器）**:
1. **未完成建筑**: `UNDER_CONSTRUCTION` → `PLANNING` → `DAMAGED`
2. **需要修复的完成建筑**: `COMPLETED` 状态但 `health < max_health`
3. **空弹药箭塔**: 需要装填弹药的箭塔

**金币需求计算**:
- **修复建筑**: `(max_health - current_health) × (建造成本 × 0.001)`
- **装填弹药**: `max_ammunition - current_ammunition`
- **建造建筑**: `building.config.cost_gold ÷ 2` (工程师建造成本为建筑成本的一半)

**工程师建造成本系统**:
- **成本减半**: 工程师建造建筑时只需要支付建筑总成本的一半
- **智能计算**: 自动从BuildingRegistry获取真实建筑成本并计算一半
- **成本优势**: 大幅降低工程师的建造成本，提高建造效率
- **资源优化**: 工程师可以更频繁地建造建筑，加快地下城发展速度

**关键设计特点**:
- **资源安全优先**: 总是优先处理携带的金币，避免资源丢失
- **建筑锁定机制**: 选择阶段不锁定建筑，工作阶段才锁定
- **智能金币管理**: 根据建筑类型和状态计算精确的金币需求

#### 🎲 工程师状态切换器

**核心功能**:
工程师状态切换器确保工程师不会长时间停留在空闲状态，自动触发游荡行为。

**工作原理**:
```python
# 工程师状态切换器配置
waiting_timeout = 2.0秒          # 等待超时时间
state_change_cooldown = 0.5秒    # 状态切换冷却时间
waiting_states = [EngineerStatus.IDLE, EngineerStatus.WANDERING]
```

**切换逻辑**:
1. **等待状态检测**: 监控工程师是否处于空闲或游荡状态
2. **超时判断**: 等待超过2秒后触发状态切换
3. **自动游荡**: 切换到EngineerStatus.WANDERING状态
4. **工作保持**: 游荡时继续检查新任务，保持工作效率

**兼容性设计**:
- **重写状态切换器**: 保持工程师特有的工作逻辑
- **任务优先级**: 工作优先于游荡，持续寻找新任务
- **状态管理**: 使用EngineerStatus枚举，与现有系统兼容
- **状态超时机制**: 空闲超过1秒自动转为游荡状态

#### 🤖 自动分配器系统
游戏采用智能的**自动分配器**系统，确保工程师高效完成各种建筑任务：

**分配策略**:
- **平衡策略**: 默认使用平衡策略，综合考虑距离、工作负载和优先级
- **最近优先**: 优先分配距离最近的工程师
- **效率优先**: 优先分配工作效率最高的工程师
- **随机分配**: 随机选择工程师和任务
- **冷却机制**: 0.1秒分配冷却时间，避免频繁重新分配

**任务类型**:
1. **建造任务**: 未完成建筑的建造工作（优先级：HIGH）
2. **修理任务**: 受损建筑的修复工作（优先级：CRITICAL/HIGH）
3. **装填任务**: 箭塔弹药的装填工作（优先级：NORMAL）
4. **金币存储**: 建筑金币存储任务（优先级：LOW）

**任务优先级权重**:
- **CRITICAL**: 10.0 - 关键任务（紧急修理）
- **HIGH**: 7.0 - 高优先级（正常建造、修理）
- **NORMAL**: 4.0 - 普通优先级（升级、装填）
- **LOW**: 1.0 - 低优先级（维护任务）

**智能特性**:
- **状态兼容**: 支持IDLE和WANDERING状态的工程师
- **任务清理**: 自动清理无效任务（如地牢之心的金币存储任务）
- **优先级排序**: 按任务优先级和创建时间排序
- **工程师匹配**: 为每个任务寻找最适合的工程师
- **实时更新**: 持续扫描建筑状态，创建新任务
- **任务完成检测**: 自动检测任务完成状态并清理

**工作流程**:
1. **扫描建筑**: 检查所有建筑的工作需求
2. **创建任务**: 为需要的建筑创建相应任务
3. **处理完成**: 清理已完成的任务
4. **重新分配**: 为空闲工程师分配新任务
5. **分配新任务**: 按优先级分配待处理任务
6. **更新统计**: 更新工程师统计信息

### 🎨 建筑状态高亮系统
建筑现在支持状态高亮显示，通过统一的StatusIndicator系统实现：
- **未完成建筑**: 红色边框高亮，表示需要工程师完成建造
- **被摧毁建筑**: 深红色粗边框高亮，表示建筑被敌人摧毁
- **受损建筑**: 黄色边框高亮，表示建筑生命值不满
- **完成建筑**: 绿色边框高亮，表示建筑建造完成并正常运行
- **边框样式**: 只绘制边框，不填充中间区域，保持建筑外观清晰

### 💰 金库存储系统
金库现在拥有独立的存储系统，与主基地完全分离：
- **独立存储**: 每个金库提供500金币独立存储容量
- **智能选择**: 苦工和工程师优先选择距离200像素内的金库进行存储
- **详细日志**: 存储操作包含建筑名称、坐标和当前存储状态
- **坐标转换**: 修复了瓦片坐标与像素坐标的转换问题，确保距离计算准确
- **存储回退**: 当找不到金库时，苦工会自动回退到主基地存储，确保金币不会丢失

## 🎯 建筑分类

### 🏠 基础设施建筑
- 地下城的基本功能建筑
- 提供资源存储和生产功能
- 建造成本较低，建造时间较短

### 🎓 功能性建筑
- 提供特殊功能和增益效果
- 支持怪物训练和技能提升
- 建造成本中等，功能多样化

### 🔒 军事建筑
- 提供防御和军事支援功能
- 增强地下城的战斗能力
- 建造成本较高，战略价值重要

### 🔮 魔法建筑
- 提供魔法相关的特殊功能
- 支持高级法术和魔法研究
- 建造成本很高，需要特殊资源

## 📊 建筑图鉴总览

### 🏠 基础设施建筑一览表

| 建筑类型 | 建造成本 | 工程师成本 | 建造时间 | 工程师需求 | 主要功能 | 建筑等级 |
| -------- | -------- | ---------- | -------- | ---------- | -------- | -------- |
| 地牢之心 | 0金币    | 0金币      | 预建     | 0个        | 核心建筑 | ⭐⭐⭐⭐⭐    |
| 金库     | 100金币  | 50金币     | 60秒     | 1个        | 资源存储 | ⭐⭐       |
| 兽人巢穴 | 200金币  | 100金币    | 150秒    | 1个        | 训练兽人 | ⭐⭐⭐      |
| 恶魔巢穴 | 200金币  | 100金币    | 180秒    | 1个        | 召唤恶魔 | ⭐⭐⭐⭐     |

### 🎓 功能性建筑一览表

| 建筑类型 | 建造成本 | 工程师成本 | 建造时间 | 工程师需求 | 主要功能 | 建筑等级 |
| -------- | -------- | ---------- | -------- | ---------- | -------- | -------- |
| 训练室   | 200金币  | 100金币    | 120秒    | 1个        | 怪物训练 | ⭐⭐⭐      |
| 图书馆   | 250金币  | 125金币    | 150秒    | 1个        | 法力研究 | ⭐⭐⭐      |
| 工坊     | 300金币  | 150金币    | 180秒    | 2个        | 陷阱制造 | ⭐⭐⭐      |

### 🔒 军事建筑一览表

| 建筑类型 | 建造成本 | 工程师成本 | 建造时间 | 工程师需求 | 主要功能 | 建筑等级 |
| -------- | -------- | ---------- | -------- | ---------- | -------- | -------- |
| 监狱     | 200金币  | 100金币    | 100秒    | 1个        | 俘虏关押 | ⭐⭐⭐      |
| 刑房     | 400金币  | 200金币    | 200秒    | 2个        | 转换加速 | ⭐⭐⭐⭐     |
| 箭塔     | 200金币  | 100金币    | 100秒    | 1个        | 自动攻击 | ⭐⭐⭐      |
| 奥术塔   | 200金币  | 100金币    | 100秒    | 1个        | 魔法攻击 | ⭐⭐⭐      |
| 防御工事 | 180金币  | 90金币     | 80秒     | 1个        | 区域防御 | ⭐⭐       |

### 🔮 魔法建筑一览表

| 建筑类型   | 建造成本 | 工程师成本 | 建造时间 | 工程师需求 | 主要功能 | 建筑等级 |
| ---------- | -------- | ---------- | -------- | ---------- | -------- | -------- |
| 魔法祭坛   | 120金币  | 60金币     | 160秒    | 1个        | 法力生成 | ⭐⭐⭐⭐     |
| 暗影神殿   | 800金币  | 400金币    | 300秒    | 3个        | 高级魔法 | ⭐⭐⭐⭐⭐    |
| 魔法研究院 | 600金币  | 300金币    | 240秒    | 2个        | 法术研究 | ⭐⭐⭐⭐     |

## 🏠 基础设施建筑

### 💖 地牢之心 (Dungeon Heart)

#### 🎨 建筑外观
![地牢之心](img/Building/地牢之心.png)

#### 📊 基础属性
- **建造成本**: 0金币 (游戏开始时自动放置)
- **建造时间**: 预建完成
- **工程师需求**: 0个
- **生命值**: 1000
- **护甲值**: 10
- **颜色**: 深红色 (#8B0000)
- **体型**: 超大型 (40x40像素)
- **建筑等级**: ⭐⭐⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 核心建筑
- **占地面积**: 2x2瓦片
- **特殊能力**: 资源存储、工程师训练、全地牢指挥中心

#### 💰 经济功能
- **金币存储**: 最大2000金币容量
- **法力存储**: 最大1000法力容量
- **资源中转**: 所有资源的集散中心
- **工程师训练**: 可训练新的工程师单位

#### 🛡️ 防御功能
- **高防御**: 10点护甲值，减少大量伤害
- **警报系统**: 受到攻击时全地牢单位自动防御
- **核心保护**: 被摧毁时游戏失败

#### 🧠 AI行为
**功能优先级**:
1. 接收和存储所有资源
2. 训练和派遣工程师
3. 协调全地牢的建造和防御活动

#### 🎯 战略价值
- **游戏核心**: 整个地下城的心脏和指挥中心
- **资源枢纽**: 所有经济活动的核心
- **防御目标**: 敌人的主要攻击目标，需要重点保护

#### 📈 升级建议
- **优先保护**: 在周围建造防御建筑
- **工程师管理**: 合理安排工程师的训练和分配
- **资源规划**: 利用无限存储优势进行长期规划

---

### 💰 金库 (Treasury)

#### 🎨 建筑外观
![金库](img/Building/金库.png)

#### 📊 基础属性
- **建造成本**: 100金币
- **建造时间**: 60秒
- **工程师需求**: 1个
- **生命值**: 200
- **护甲值**: 5
- **颜色**: 金黄色 (#FFD700)
- **体型**: 中等 (20x20像素)
- **建筑等级**: ⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 经济建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 金币存储、金币交换

#### 💰 经济功能
- **独立存储**: 提供500金币独立存储容量，与主基地存储完全分离
- **智能选择**: 苦工和工程师优先选择距离200像素内的金库进行存储
- **金币交换**: 苦工和工程师可以存取金币，支持详细的存储日志
- **存储管理**: 智能存储空间管理，实时显示存储状态
- **坐标系统**: 修复了瓦片坐标与像素坐标转换问题，确保距离计算准确
- **存储回退**: 当苦工找不到金库时，自动回退到主基地存储，确保金币不丢失
- **日志格式**: 存储日志包含建筑名称、坐标和当前存储状态 (格式: 当前存储/总容量)
- **零维护成本**: 金库作为存储设施，不需要维护成本，不会消耗金币
- **资源面板集成**: 金库中存储的金币会计算到总金币显示中

#### 🏗️ 建造流程
**建造阶段**:
1. 规划阶段 (10秒): 工程师到达并规划建造
2. 基础阶段 (20秒): 挖掘基础，搭建框架
3. 建设阶段 (25秒): 安装金库设备和保险装置
4. 完工阶段 (5秒): 最终装饰，激活金库功能

#### 🧠 AI行为
**功能优先级**:
1. 接收苦工和工程师的金币存储
2. 管理独立存储空间
3. 提供金币存取服务

#### 🎯 战略价值
- **存储扩展**: 提供额外的金币存储空间
- **资源管理**: 分散存储风险，提高资源安全性
- **工作支持**: 为苦工和工程师提供就近存储点

#### 📈 使用建议
- **战略位置**: 建造在挖掘区域附近，确保距离在200像素内，减少苦工运输距离
- **存储规划**: 根据主基地存储容量合理分配金库数量，每个金库提供500金币独立存储
- **工作流程**: 配合苦工和工程师的工作路径优化存储效率，利用智能选择机制
- **坐标优化**: 考虑瓦片坐标与像素坐标的转换，确保距离计算准确
- **存储回退**: 利用存储回退机制确保苦工的金币不会丢失，即使没有金库也能正常存储
- **日志监控**: 利用详细的存储日志监控金库使用情况和存储状态

---

### 🏠 巢穴 (Lair)

#### 🎨 建筑外观
![巢穴](img/Building/巢穴.png)

#### 📊 基础属性
- **建造成本**: 150金币
- **建造时间**: 90秒
- **工程师需求**: 1个
- **生命值**: 250
- **护甲值**: 4
- **颜色**: 深棕色 (#654321)
- **体型**: 大型 (25x25像素)
- **建筑等级**: ⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 住房建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 怪物休息、治疗加速、士气提升

#### 👹 怪物功能
- **住房容量**: 可容纳5个怪物单位
- **治疗加速**: 怪物治疗速度提升100%
- **士气加成**: 周围60像素内怪物攻击力+10%
- **休息恢复**: 怪物在巢穴中每秒回复2点生命值

#### 🏗️ 建造流程
**建造阶段**:
1. 规划阶段 (15秒): 选择最佳建造位置
2. 基础阶段 (30秒): 挖掘洞穴，加固结构
3. 建设阶段 (35秒): 布置休息设施和治疗装置
4. 完工阶段 (10秒): 环境布置，激活巢穴功能

#### 🧠 AI行为
**功能优先级**:
1. 自动接纳受伤的怪物进行治疗
2. 为周围怪物提供士气加成
3. 管理怪物的休息和恢复

#### 🎯 战略价值
- **怪物支援**: 为战斗单位提供治疗和恢复
- **战斗增益**: 士气加成提升战斗效率
- **持续作战**: 支持长期防御战略

#### 📈 使用建议
- **战略位置**: 建造在防御前线附近
- **数量规划**: 根据怪物数量建造足够的巢穴
- **升级考虑**: 后期可升级为大巢穴，容量翻倍

---

### 👿 恶魔巢穴 (Demon Lair)

#### 📊 基础属性
- **建造成本**: 200金币
- **建造时间**: 180秒
- **工程师需求**: 1个
- **生命值**: 450
- **护甲值**: 6
- **颜色**: 靛青色 (#4B0082)
- **体型**: 中等 (20x20像素)
- **建筑等级**: ⭐⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 召唤建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 自动召唤小恶魔

#### 👿 召唤功能
- **召唤成本**: 20金币（临时金币存储）
- **召唤时间**: 60秒
- **魔力消耗**: 每秒消耗1点魔力（使用ResourceManager统一管理）
- **召唤单位**: 小恶魔（血量800，攻击15，速度25，护甲2）
- **绑定机制**: 召唤的小恶魔自动绑定到巢穴
- **锁定状态**: 有绑定怪物时巢穴锁定，不能召唤新怪物
- **自动解锁**: 绑定怪物死亡后自动解除绑定并解锁

#### 🔄 工作流程
1. **金币投入**: 工程师投入20金币到临时金币存储
2. **开始召唤**: 临时金币满20时自动开始召唤
3. **魔力检查**: 每秒检查魔力是否充足（需要1点/秒，使用ResourceManager）
4. **暂停恢复**: 魔力不足时暂停召唤，魔力恢复后继续
5. **完成召唤**: 60秒后生成小恶魔，绑定到巢穴，清空临时金币
6. **死亡通知**: 小恶魔死亡时自动通知巢穴解除绑定

#### 🧠 AI行为
**功能优先级**:
1. 检查临时金币是否充足（≥20金币）
2. 检查魔力是否充足（每秒1点，使用ResourceManager）
3. 执行召唤倒计时（60秒）
4. 生成小恶魔并绑定
5. 等待小恶魔死亡后解锁

#### 🎯 战略价值
- **持续生产**: 自动生成小恶魔补充战力
- **经济转化**: 将金币和魔力转化为战斗单位
- **防御支援**: 为防线提供源源不断的战斗力

#### 📈 使用建议
- **魔力保障**: 确保魔法祭坛提供充足的魔力（ResourceManager统一管理）
- **金币投入**: 安排工程师定期投入金币
- **死亡清理**: 利用自动解锁机制持续生产
- **成本效益**: 建造成本降低至200金币，性价比更高

---

### 🗡️ 兽人巢穴 (Orc Lair)

#### 📊 基础属性
- **建造成本**: 200金币
- **建造时间**: 150秒
- **工程师需求**: 1个
- **生命值**: 500
- **护甲值**: 6
- **颜色**: 马鞍棕色 (#8B4513)
- **体型**: 中等 (20x20像素)
- **建筑等级**: ⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 训练建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 训练兽人战士

#### 🗡️ 训练功能
- **训练成本**: 30金币（临时金币存储）
- **训练时间**: 90秒
- **金币投入**: 需要30金币才能开始训练
- **训练单位**: 兽人战士（强力近战单位）
- **绑定机制**: 训练的兽人战士自动绑定到巢穴
- **锁定状态**: 有绑定怪物时巢穴锁定，不能训练新怪物
- **自动解锁**: 绑定怪物死亡后自动解除绑定并解锁

#### 🔄 工作流程
1. **金币投入**: 工程师投入30金币到临时金币存储
2. **开始训练**: 临时金币满30时自动开始训练
3. **训练倒计时**: 等待90秒训练时间
4. **完成训练**: 生成兽人战士，绑定到巢穴，清空临时金币
5. **死亡通知**: 兽人战士死亡时自动通知巢穴解除绑定

#### 🧠 AI行为
**功能优先级**:
1. 检查临时金币是否充足（≥30金币）
2. 执行训练倒计时
3. 生成兽人战士并绑定
4. 等待兽人战士死亡后解锁

#### 🎯 战略价值
- **强力单位**: 兽人战士是强大的近战战斗单位
- **经济投入**: 需要较多金币但产出高价值战力
- **防御核心**: 为防线提供坚实的防御力量

#### 📈 使用建议
- **金币充足**: 确保有足够的金币进行持续训练
- **防线部署**: 将兽人战士部署在关键防御位置
- **死亡管理**: 利用自动解锁机制在兽人战士死亡后继续训练

---

## 🎓 功能性建筑

### 🏋️ 训练室 (Training Room)

#### 🎨 建筑外观
![训练室](img/Building/训练室.png)

#### 📊 基础属性
- **建造成本**: 200金币
- **建造时间**: 120秒
- **工程师需求**: 1个
- **生命值**: 300
- **护甲值**: 6
- **颜色**: 铁灰色 (#708090)
- **体型**: 大型 (30x30像素)
- **建筑等级**: ⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 训练建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 怪物能力提升、技能训练、战斗经验获得

#### 💪 训练功能
- **训练速度**: 1.5倍经验获得
- **同时训练**: 最多3个怪物
- **训练项目**: 攻击力、生命值、移动速度、特殊技能
- **训练时间**: 每个属性需要60秒训练时间

#### 🏗️ 建造流程
**建造阶段**:
1. 规划阶段 (20秒): 设计训练场地布局
2. 基础阶段 (40秒): 建造训练设施基础结构
3. 建设阶段 (50秒): 安装训练器械和设备
4. 完工阶段 (10秒): 调试设备，激活训练功能

#### 🎯 战略价值
- **能力提升**: 显著提升怪物的战斗能力
- **长期投资**: 训练过的怪物价值更高
- **战术优势**: 训练有素的军队战斗力更强

#### 📈 使用建议
- **中期建造**: 有一定经济基础后建造
- **重点训练**: 优先训练高价值怪物
- **配合使用**: 与巢穴配合，形成训练-休息循环

---

### 📚 图书馆 (Library)

#### 🎨 建筑外观
![图书馆](img/Building/图书馆.png)

#### 📊 基础属性
- **建造成本**: 250金币
- **建造时间**: 150秒
- **工程师需求**: 1个
- **生命值**: 200
- **护甲值**: 5
- **颜色**: 深蓝色 (#191970)
- **体型**: 大型 (28x28像素)
- **建筑等级**: ⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 研究建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 法力生成、法术研究、知识存储

#### 🔮 魔法功能
- **法力生成**: 每秒生成0.2点法力
- **研究能力**: 解锁新的法术和技能
- **知识存储**: 保存研究进度和法术配方
- **法术增强**: 附近施法单位法术威力+15%

#### 🏗️ 建造流程
**建造阶段**:
1. 规划阶段 (25秒): 规划图书馆布局和藏书区
2. 基础阶段 (50秒): 建造书架和阅读区域
3. 建设阶段 (60秒): 安装魔法研究设备
4. 完工阶段 (15秒): 整理魔法书籍，激活研究功能

#### 🎯 战略价值
- **魔法支持**: 为法术系统提供基础支持
- **研究中心**: 解锁高级法术和能力
- **法力来源**: 提供稳定的法力收入

#### 📈 使用建议
- **魔法流**: 魔法流玩家的必备建筑
- **研究规划**: 优先研究关键法术
- **位置选择**: 靠近法师单位和魔法建筑

---

## 🔒 军事建筑

### 🏹 箭塔 (Arrow Tower)

#### 🎨 建筑外观
![箭塔](img/Building/箭塔.png)

#### 📊 基础属性
- **建造成本**: 200金币
- **建造时间**: 100秒
- **工程师需求**: 1个
- **生命值**: 800
- **护甲值**: 5
- **颜色**: 石灰色 (#D3D3D3)
- **体型**: 高塔型 (15x35像素)
- **建筑等级**: ⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 防御建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 自动攻击入侵者

#### 🏹 攻击功能
- **攻击范围**: 100像素半径
- **攻击力**: 30点物理伤害
- **攻击间隔**: 1.5秒
- **弹药类型**: 精准箭矢，有25%概率造成1.5倍暴击伤害
- **弹药系统**: 最大弹药60发，每发消耗1金币，工程师自动装填
- **击退效果**: 强击退力，击退距离10.8像素，使用重击类型攻击

#### 🏗️ 建造流程
**建造阶段**:
1. 规划阶段 (15秒): 选择最佳射击位置
2. 基础阶段 (35秒): 建造塔基和支撑结构
3. 建设阶段 (40秒): 安装弓弩装置和瞄准系统
4. 完工阶段 (10秒): 校准射击精度，激活自动攻击

#### 🧠 AI行为
**攻击优先级**:
1. 攻击范围内威胁最大的敌人
2. 优先攻击血量较低的目标
3. 自动调整射击角度追踪移动目标

**击退系统**:
- **击退触发**: 每次成功攻击都会触发击退效果
- **击退计算**: 使用物理系统API计算击退距离和方向
- **击退类型**: 重击类型，击退力为1.5倍
- **击退距离**: 基础击退距离×1.8倍，受伤害和暴击影响
- **击退增强**: 伤害影响系数(1.0 + 伤害/150.0)，暴击额外1.3倍
- **击退动画**: 包含粒子特效、闪烁效果和屏幕震动
- **击退状态**: 被击退单位暂时失去控制，无法移动和攻击
- **弹药检查**: 无弹药时不会攻击，因此不会触发击退效果

#### 🎯 战略价值
- **自动防御**: 24小时不间断自动防御
- **范围控制**: 控制关键通道和区域
- **火力支援**: 为地面部队提供远程火力支援

#### 📈 使用建议
- **关键位置**: 建造在敌人必经之路
- **交叉火力**: 多个箭塔形成交叉火力网
- **升级优先**: 优先升级射程和攻击力
- **弹药管理**: 确保有足够金币供工程师装填弹药
- **击退利用**: 利用击退效果控制敌人位置，配合其他防御设施

---

### 🔮 奥术塔 (Arcane Tower)

#### 🎨 建筑外观
![奥术塔](img/Building/奥术塔.png)

#### 📊 基础属性
- **建造成本**: 200金币
- **建造时间**: 100秒
- **工程师需求**: 1个
- **生命值**: 800
- **护甲值**: 5
- **颜色**: 紫色 (#8A2BE2)
- **体型**: 高塔型 (15x35像素)
- **建筑等级**: ⭐⭐⭐

#### 🏗️ 建筑特性
- **建筑类型**: 魔法防御建筑
- **占地面积**: 1x1瓦片
- **特殊能力**: 自动魔法攻击

#### 🔮 攻击功能
- **攻击范围**: 100像素半径
- **攻击力**: 40点魔法伤害
- **攻击间隔**: 2.5秒
- **攻击类型**: 魔法攻击，有25%概率造成2.0倍暴击伤害
- **范围攻击**: 圆形范围攻击，半径60像素，伤害为原伤害的80%
- **魔力消耗**: 每次攻击消耗1点魔力

#### 🏗️ 建造流程
**建造阶段**:
1. 规划阶段 (15秒): 选择最佳魔法阵位置
2. 基础阶段 (35秒): 建造魔法塔基和能量核心
3. 建设阶段 (40秒): 安装奥术水晶和魔法增幅器
4. 完工阶段 (10秒): 激活魔法阵，启动自动攻击

#### 🧠 AI行为
**攻击优先级**:
1. 攻击范围内威胁最大的敌人
2. 优先攻击血量较低的目标
3. 自动调整魔法弹道追踪移动目标

**范围攻击系统**:
- **攻击类型**: 圆形范围魔法攻击
- **伤害计算**: 范围攻击伤害为原伤害的80%
- **攻击半径**: 60像素圆形范围
- **特效系统**: 深蓝色魔法冲击特效
- **目标筛选**: 只攻击敌人单位

#### 🎯 战略价值
- **范围控制**: 强大的范围攻击能力
- **魔法防御**: 对魔法抗性低的敌人效果显著
- **持续火力**: 提供稳定的魔法火力支援
- **区域控制**: 控制关键通道和区域

#### 📈 使用建议
- **关键位置**: 建造在敌人密集区域
- **魔法配合**: 与图书馆配合提升魔法效果
- **范围利用**: 利用圆形攻击覆盖更多敌人
- **魔力管理**: 确保有足够的魔力供应

---

## 👷 地精工程师系统

### 🔨 地精工程师 (Goblin Engineer)

#### 🎨 角色头像
![地精工程师](img/Monster/地精工程师.png)

#### 📊 基础属性
- **召唤成本**: 100金币
- **生命值**: 800
- **攻击力**: 15
- **移动速度**: 25
- **建造效率**: 1.0倍
- **修理效率**: 0.5倍
- **最大并发项目**: 1个
- **金币携带量**: 60金币
- **颜色**: 酸绿色 (#32CD32)
- **体型**: 中等 (14像素)
- **工程师等级**: ⭐⭐

#### 🔧 建造能力
- **可建造类型**: 所有基础建筑类型
- **同时项目**: 1个建造项目
- **建造速度**: 每秒投入4金币
- **修理能力**: 可修理受损建筑（效率1.0倍）
- **装填能力**: 可为箭塔装填弹药
- **金币存储**: 可为建筑存储金币
- **特殊技能**: 擅长建造陷阱和防御设施

#### 🏗️ 工作流程
**工作循环**:
1. 接受建造任务
2. 移动到建造地点
3. 执行建造工作
4. 完工后返回待命状态

#### 🎯 使用价值
- **经济实惠**: 成本低廉，适合大量召唤
- **全能建设**: 能够建造所有基础建筑
- **陷阱专家**: 在建造陷阱类建筑时效率更高
- **灵活机动**: 移动速度适中，工作效率稳定

#### 📈 使用建议
- **基础力量**: 游戏开始后的主要建设力量
- **数量优势**: 可以同时召唤多个形成建设队伍
- **防御建设**: 优先用于建造防御性建筑和陷阱
- **维护工作**: 负责日常的建筑修理和维护

#### 🎨 状态指示器系统
地精工程师使用统一的状态指示器系统，与其他游戏单位保持一致的视觉设计：

- **指示器规格**: 横向圆角矩形 (8x4像素)
- **位置**: 工程师上方
- **颜色编码**: 
  - ⚪ 白色: 空闲状态 (IDLE)
  - 🟠 橙色: 游荡状态 (WANDERING)
  - 🟢 深绿色: 获取资源 (FETCHING_RESOURCES)
  - 🟢 绿色: 前往工地 (MOVING_TO_SITE)
  - 🟤 深棕色: 建造中 (CONSTRUCTING)
  - 🟡 黄色: 修理中 (REPAIRING)
  - 🟣 紫色: 升级中 (UPGRADING)
  - 🔵 深蓝色: 装填中 (RELOADING)
  - 🟡 金色: 存储金币 (DEPOSITING_GOLD)
  - 🔵 青色: 返回基地 (RETURNING_TO_BASE)

#### 🔧 统一设计
- **复用系统**: 使用游戏统一的 `StatusIndicator` 类
- **状态描述**: 通过 `get_status_description()` 获取状态文字说明
- **颜色管理**: 统一的颜色配置和管理系统

---

## 🎯 建筑搭配策略

### 🏗️ 早期发展组合

#### 经济优先组合
**地牢之心 + 2个金库 + 1个巢穴**
- 成本: 350金币
- 特点: 经济发展为主，基础防御
- 工程师需求: 3个地精工程师
- 适用: 游戏前10分钟

#### 平衡发展组合
**地牢之心 + 1个金库 + 2个巢穴 + 1个训练室**
- 成本: 500金币
- 特点: 经济与军事并重
- 工程师需求: 4个地精工程师
- 适用: 游戏中期发展

### ⚔️ 防御专精组合

#### 防御堡垒组合
**地牢之心 + 3个箭塔 + 2个防御工事 + 1个监狱**
- 成本: 1310金币
- 特点: 强化防御，控制敌人
- 工程师需求: 6个地精工程师
- 适用: 面对强力英雄入侵

#### 魔法防御组合
**地牢之心 + 1个图书馆 + 1个魔法祭坛 + 2个箭塔**
- 成本: 970金币
- 特点: 魔法与物理防御结合
- 工程师需求: 5个地精工程师
- 适用: 对抗魔法英雄

### 👑 后期终极组合

#### 完美帝国组合
**地牢之心 + 暗影神殿 + 魔法研究院 + 3个金库 + 2个兽人巢穴**
- 成本: 2800金币
- 特点: 终极建筑配置，攻防兼备
- 工程师需求: 8个地精工程师
- 适用: 游戏后期统治阶段

## 📊 建筑效率分析

### 💰 经济效率排行

| 建筑类型 | 投资成本 | 回本时间 | 长期收益 | 效率评级 |
| -------- | -------- | -------- | -------- | -------- |
| 金库     | 100金币  | 200秒    | 高       | ⭐⭐⭐⭐     |
| 图书馆   | 250金币  | 1250秒   | 中等     | ⭐⭐⭐      |
| 魔法祭坛 | 120金币  | 600秒    | 高       | ⭐⭐⭐⭐     |

### 🛡️ 防御效率排行

| 建筑类型 | 建造成本 | 防御力 | 覆盖范围 | 效率评级 |
| -------- | -------- | ------ | -------- | -------- |
| 箭塔     | 200金币  | 高     | 100像素  | ⭐⭐⭐⭐     |
| 奥术塔   | 200金币  | 很高   | 100像素  | ⭐⭐⭐⭐⭐    |
| 防御工事 | 180金币  | 中等   | 80像素   | ⭐⭐⭐      |
| 监狱     | 200金币  | 特殊   | 控制型   | ⭐⭐⭐      |
| 刑房     | 400金币  | 特殊   | 转换型   | ⭐⭐⭐⭐     |

## 🎮 建造技巧指南

### 💡 新手建议

1. **优先经济**: 前期优先建造金库发展经济
2. **工程师管理**: 保持2-3个地精工程师
3. **防御布局**: 在关键位置建造箭塔
4. **资源平衡**: 平衡金币和建造时间的投入

### 🎯 进阶技巧

1. **建造队列**: 合理安排建造顺序和优先级
2. **工程师数量**: 根据建造需求调整地精工程师数量
3. **建筑升级**: 优先升级关键建筑
4. **位置优化**: 根据地形选择最佳建造位置

### 🏆 大师策略

1. **建筑协同**: 利用建筑间的协同效应
2. **时机控制**: 在合适的时机建造合适的建筑
3. **资源优化**: 最大化资源利用效率
4. **战术灵活**: 根据敌人调整建筑策略

---

## 🎨 金矿UI设计

### 💎 现代化金矿界面
游戏中的金矿现在采用全新的现代化UI设计：

#### 🎯 视觉特性
- **动态颜色**: 根据储量显示不同金色（高储量亮金、中储量琥珀、低储量暗金）
- **钻石图标**: 使用钻石形状替代传统闪电符号，更加现代化
- **储量条**: 底部显示储量百分比，直观了解剩余资源
- **发光效果**: 根据储量显示不同强度的发光效果

#### 🔧 状态指示
- **挖掘状态**: 彩色边框显示挖掘者数量（绿色1人、黄色2人、红色3人满员）
- **储量警告**: 储量低于50时显示具体数字
- **枯竭状态**: 枯竭矿脉显示X符号和棕色背景

#### 📊 信息显示
- **储量条**: 实时显示矿脉储量百分比
- **挖掘者计数**: 右上角显示当前挖掘者数量
- **状态边框**: 不同颜色边框表示不同挖掘状态

### ⛏️ 挖掘日志优化
苦工挖掘系统现在采用优化的日志输出机制：
- **频率控制**: 每5次挖掘输出一次日志，减少控制台冗余
- **坐标信息**: 挖掘日志包含金矿的瓦片坐标信息
- **格式示例**: `⛏️ 哥布林苦工挖掘了 2 金币 (携带: 10/10) 金矿位置: (25, 9)`
- **智能计数**: 自动重置计数器，确保日志输出的准确性

## 🔄 工程师工作流程详解

### 📊 状态转换流程图

```
开始 → IDLE (空闲)
  ↓
检查携带金币 → 有金币 → RETURNING_TO_BASE (返回基地)
  ↓
无金币 → 等待分配器 → 分配器分配任务 → 检查金币需求
  ↓                    ↓
超时1秒 → WANDERING     金币不足 → FETCHING_RESOURCES (获取资源)
(游荡)                  ↓
                      金币充足 → MOVING_TO_SITE (前往工地)
                              ↓
                        到达建筑 → 开始工作
                              ↓
                    CONSTRUCTING/REPAIRING/UPGRADING/RELOADING
                              ↓
                        工作完成 → 返回 IDLE
```

### 🤖 自动分配器工作流程

```
分配器启动 → 扫描建筑状态
    ↓
创建工作任务 → 按优先级排序
    ↓
检查工程师状态 → 寻找可用工程师
    ↓
分配任务 → 工程师接受任务
    ↓
任务执行 → 任务完成 → 清理任务
    ↓
继续扫描 → 创建新任务
```

### 🎯 工作优先级决策树

```
工程师状态检查
├── 携带金币 > 0？
│   ├── 是 → RETURNING_TO_BASE (存储金币)
│   └── 否 → 等待自动分配器
│       ├── 分配器分配任务？
│       │   ├── 是 → 检查金币需求
│       │   │   ├── 金币充足 → MOVING_TO_SITE
│       │   │   └── 金币不足 → FETCHING_RESOURCES
│       │   └── 否 → 空闲时间检查
│       │       ├── > 1秒 → WANDERING
│       │       └── ≤ 1秒 → 继续 IDLE
│       └── 自动分配器任务优先级
│           ├── 1. 建造任务 (PLANNING/UNDER_CONSTRUCTION)
│           ├── 2. 修理任务 (COMPLETED + health < max_health)
│           ├── 3. 装填任务 (arrow_tower + ammunition = 0)
│           └── 4. 金币存储任务 (需要金币存储的建筑)
```

### 🤖 自动分配器决策树

```
分配器启动
├── 扫描所有建筑
│   ├── 未完成建筑 → 创建建造任务
│   ├── 受损建筑 → 创建修理任务
│   ├── 空弹药箭塔 → 创建装填任务
│   └── 需要金币存储 → 创建存储任务
├── 按优先级排序任务
│   ├── 高优先级: 建造任务
│   ├── 中优先级: 修理任务
│   └── 低优先级: 装填/存储任务
├── 寻找可用工程师
│   ├── IDLE状态工程师
│   └── WANDERING状态工程师
└── 分配任务给最适合的工程师
    ├── 距离最近
    ├── 工作负载最少
    └── 效率最高
```

### 💰 金币管理策略

**资源安全原则**:
- 工程师总是优先处理携带的金币
- 只有在没有金币的情况下才寻找新工作
- 避免资源丢失和浪费

**智能需求计算**:
- 修复费用: 建造成本的0.1% × 缺失生命值
- 装填费用: 缺失弹药数量
- 建造费用: 建筑配置的金币成本

**建筑锁定机制**:
- 选择阶段: 允许多个工程师选择同一建筑
- 工作阶段: 只有真正开始工作时才锁定建筑
- 避免工程师冲突和资源浪费

### 🔧 调试和监控

工程师系统提供详细的调试信息：
- 建筑选择过程和原因
- 金币需求计算详情
- 状态转换触发条件
- 工作进度实时更新

通过这套智能优先级系统，工程师能够高效、安全地完成各种建筑任务，确保地下城的建设和发展顺利进行！

## 🎉 掌握建筑艺术！

通过深入了解每种建筑的特性和建造机制，你将能够创建出强大而高效的地下帝国。记住，每个建筑都有其独特的价值和战略意义，关键在于如何合理搭配和使用它们！🏰⚔️👷

*建造你的传奇，每一块砖石都见证你的荣耀！*